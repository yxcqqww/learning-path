/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：www.guanaihui.com
 2. 页面名称：index(首页)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function IndexController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    页面顶部全部服务分类下拉
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.servicesCategory({
        "mode": "auto"
    });
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    tab切换
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.swapTabs();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    热门体检机构鼠标悬浮事件
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.hotRecommendListener();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    首页的banner滑动
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.initSlider();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    回到页面顶部以及在线咨询两个按钮的浮动条   
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.floater();

    this.textHandler();

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    绑定事件   
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    //this.bindEvents();
    
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    图片上传设置
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.setImg();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    index  top栏获取东西
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.ajaxSet();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    首页加载
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.aniDh();

};
/*首页加载js*/
IndexController.prototype.aniDh=function(){
     $('#ftshow button').click(function(){
        $('#ftshow').animate({left:'100%'},300);

    });
}
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
首页的banner滑动
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
IndexController.prototype.initSlider = function() {
    require([this.utilStaticPrefix + "/jquery.slide.min.js"], function() {
        $(".bannerSwap").slide({
            autoPlay: true,
            titCell: ".header-pagination ul li",
            effect: "leftLoop",
            interTime: 4000,
            vis: 1
        });
    });
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
热门体检机构鼠标悬浮事件,延迟两秒
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
IndexController.prototype.hotRecommendListener = function() {
    if ($(".hot-recommend a").size() === 0) return;
    var timoutid = null;
    $(".hot-recommend a").each(function(index) {
        $(this).mouseover(function() {
            var aNode = $(this);
            timoutid = setTimeout(function() {
                aNode.addClass("selected").find("dl").slideDown().parent("a").siblings("a").removeClass("selected").find("dl").slideUp();
            }, 200);
        }).mouseout(function() {
            clearTimeout(timoutid);
        });
    });

};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 处理文本，当文本超过指定长度时截取。
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
IndexController.prototype.textHandler = function() {
    $("[data-text][data-text-length]").each(function(i, item) {
        var textLength = parseInt($(item).attr("data-text-length"));
        var text = $(item).attr("data-text");
        if (text.length > textLength) {
            text = text.substring(0, textLength - 1) + "...";
        }
        $(item).text(text);
    });
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 GA监测
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
IndexController.prototype.textHandler = function() {
    /*$("a[href='http://www.360guanai.com/']").on("click", function() {
        ga('send', 'event', 'Menu', 'tijiantong', '关爱体检通菜单链接');
    });*/
    // 关爱体检通菜单链接
    $('.container dd').on('click', 'a', function() {
        ga('send', 'event', 'links', 'click', '体检通');
    });

    // 首页BANNER右侧广告位
    $('.hot').find('a').on('click', function() {
        ga('send', 'event', 'banner', 'click', '右侧BANNER');
    });
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 图片上传设置
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
IndexController.prototype.setImg = function() {
    var imgWidth=$('.templet1 img').width();
    var imgHight=$('.templet1 img').height();
    var ratio=imgWidth/imgHight;  //图片宽高比值
    
    var initial=($('.templet1').width())/($('.templet1').height());//外面盒子宽高比值
    if(ratio>initial){
        $('.templet1 img').css({
            'width':$('.templet1').width()+'px',
            'height':'auto'
        });
        var marginTop = ($('.templet1').height()-$('.templet1 img').height())/2;  //高度差
        $('.templet1 img').css('margin-top',marginTop+'px');
    }else if(ratio==initial){
        $('.templet1 img').css({
            'width':'1200px',
            'height':'130px'
        });
    }else if(ratio<initial){
        $('.templet1 img').css({
            'height':$('.templet1').height()+'px',
            'width':'auto'
        });
        var marginLeft = ($('.templet1').width()-$('.templet1 img').width())/2;  //高度差
        $('.templet1 img').css('margin-left',marginLeft+'px');
    }
}

/*top栏获取一些东西*/
IndexController.prototype.ajaxSet=function(){
    $.ajaxSetup ({ 
        cache: false 
    });
    $(".topper-service").load('/personal/toper/count', function(data){
    });
}



/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 类的初始化
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function() {
    new IndexController;
});
