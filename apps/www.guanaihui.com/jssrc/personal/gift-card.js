/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：www.guanaihui.com
 2. 页面名称：BindGiftCard(绑定礼品卡)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function bindGiftCardController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    页面顶部全部服务分类下拉
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.servicesCategory();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    提交表单操作
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.submitForm();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    top 栏
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.ajaxSet();

};
/*top栏获取一些东西*/
bindGiftCardController.prototype.ajaxSet=function(){
    $.ajaxSetup ({ 
        cache: false 
    });
    $(".topper-service").load('/personal/toper/count', function(data){
    });
}
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
提交表单操作
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
bindGiftCardController.prototype.submitForm = function() {
    var classSelf = this;
    require([classSelf.utilStaticPrefix + '/jquery.asyncsubmit.js'], function() {
        $('#submitForm').asyncsubmit({
            dataType: classSelf.apiDataType,
            scroll: false,
            utilStaticPrefix: classSelf.utilStaticPrefix,
            apiUrl: classSelf.loginApiUrl,
            showOneMessage: true,
            maxErrorsPerField: 1,
            beforeSaveInterface: function() {
                //$('#submitForm').attr("disabled","disabled");
                // GA监测 
                ga('send', 'event', 'giftcard', 'binding', '绑定畅享卡', parseInt($("input[name='cardNo']").val()));
            },
            onSavingInterface: function() {

            },
            onErrorInterface: function() {
                $("#btnSubmit").removeAttr("disabled");
                classSelf.tips("请求失败，请检查您的接口！", 3);
            },
            onSuccessInterface: function(data) {
                window.history.go(0);
            },
            onExceptionInterface: function(message) {
                $("#btnSubmit").removeAttr("disabled");
                classSelf.tips("<span class=\"text-danger\">" + message + "</span>", 5);
            }
        });
    });
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 类的初始化
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function() {
    new bindGiftCardController;
});
