/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：www.guanaihui.com
 2. 页面名称：index(个人中心)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function IndexController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    页面顶部全部服务分类下拉
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.servicesCategory();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    tab切换
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.swapTabs();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    点击预约详情显示详情
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.showDetails();
    //
    ///*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    //点击评价显示评价相关内容
    //-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    //this.showComments();
    //
    ///*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    //确认评价
    //-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    //this.confirmComment();

    //this.tabChange();

    this.dropBookingHandler();
    this.ajaxSet();

};
/*top栏获取一些东西*/
IndexController.prototype.ajaxSet=function(){
    $.ajaxSetup ({ 
        cache: false 
    });
    $(".topper-service").load('/personal/toper/count', function(data){
    });
}
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 点击预约详情显示详情
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
IndexController.prototype.showDetails = function() {
    var classSelf = this;

    $("dd.col-5 a").on("click", function() {
        var _this = $(this);
        var $markList = _this.parents("dl").siblings('.mark-list');
        var $optionsList = $markList.find(".mark-options-item ul");
        var $radioInputs = $markList.find("input:radio");
        if (!$markList.hasClass('hide')) {
            $markList.addClass('hide');
            $optionsList.addClass('hide');
            $optionsList.find("a[data-flag]").removeClass('active');
            $radioInputs.removeAttr('checked');
        }
        var bookingId = _this.parents(".item").eq(0).find("#bookingId").val();
        _this.parents(".item").eq(0).find(".booking-details").load("/personal/booking/step/" + bookingId, function() {
            $(this).removeClass("hide");

        });
    });

    $("body").on("click", ".booking-details .op", function() {
        var _this = $(this);
        var $detailsContainer = _this.parent();
        if (!$detailsContainer.hasClass('hide')) {
            $detailsContainer.addClass('hide');
        }
    });
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tab点击
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
IndexController.prototype.tabChange = function() {
    $(".tabs-handle li").click(function() {
        var tabFlag = $(this).attr("data-tabflag");
        if (tabFlag == "spec") {
            $("#specBookingList").html("<div style='font-size:12px;width:100%;text-align:center;'>加载中...</div>");
            $("#specBookingList").load("/personal/spec/list");
        } else {
            $("#chkBookingList").html("<div style='font-size:12px;width:100%;text-align:center;'>加载中...</div>");
            $("#chkBookingList").load("/personal/chk/list");
        }
    });
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 取消预约
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
IndexController.prototype.dropBookingHandler = function() {
    var _co = this;
    $("body").on("click", ".j-drop-booking", function() {
        /* var $dropBtn = $(this);
         _co.confirm({
             'content': '您确认要取消预约吗？？',
             'confirmInterface': function() {
                 var bookingId = $dropBtn.attr("data-id");
                 var data = {
                     "id": bookingId
                 };
                 var param = {
                     // 成功调用预约接口回掉
                     process: function(data) {
                         window.history.go(0);
                     },
                     onExceptionInterface: function(code, messgae) {

                     }
                 };
                 _co.request("/personal/booking/drop.do",data,param);
             }
         });*/
        $("#guanaihuiCancel").modal();

    });
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 类的初始化
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function() {
    new IndexController;
});
