/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：www.guanaihui.com
 2. 页面名称：suitList(套餐列表)
 3. 作者：赵华刚(zhaohuagang@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function ListController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this) ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    页面顶部全部服务分类下拉
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.servicesCategory() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    tabs切换
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.swapTabs() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    根据cookie来决定到底是大图模式还是列表模式
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.initDisplayHabit() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    回到页面顶部以及在线咨询两个按钮的浮动条   
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.floater() ;    
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    控制台显示模式句柄事件绑定
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.addListenerToDisplayModeHandle() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    其他热门机构的滑动
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.initSlider() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    top 栏
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.ajaxSet();
} ;

/*top栏获取一些东西*/
ListController.prototype.ajaxSet=function(){
    $.ajaxSetup ({ 
        cache: false 
    });
    $(".topper-service").load('/personal/toper/count', function(data){
    });
}
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
根据cookie来决定到底是大图模式还是列表模式
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ListController.prototype.initDisplayHabit = function() {    
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    如果cookie没有值就设置cookie的值为第一种显示模式
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    if( ! $.cookie(this.cookieKeyConf.institutionDisplayMode)) $.cookie(this.cookieKeyConf.institutionDisplayMode, $(".console .display-mode-handle a").eq(0).attr("data-mode"), { expires : this.cookieExpires , path : "/" , domain : this.cookieDomain }) ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    显示模式切换到指定风格
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.switchDisplayMode($.cookie(this.cookieKeyConf.institutionDisplayMode)) ;    
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
显示模式切换
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ListController.prototype.switchDisplayMode = function(mode) {
    $(".data-panel").removeClass("list").removeClass("waterfall").addClass(mode) ;
    $(".console .display-mode-handle a").each(function(){
        if($(this).attr("data-mode") === mode) $(this).addClass("on") ;
        else $(this).removeClass("on") ;
    }) ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    最后还要设置cookie
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $.cookie(this.cookieKeyConf.institutionDisplayMode, mode, { expires : this.cookieExpires , path : "/" , domain : this.cookieDomain }) ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
控制台显示模式句柄事件绑定，注意切换后要触发一下window的scroll事件，用来触动lazyload
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ListController.prototype.addListenerToDisplayModeHandle = function() {
    var classSelf = this ;
    $(".console .display-mode-handle a").click(function(){
        classSelf.switchDisplayMode($(this).attr("data-mode")) ;
        $(window).trigger("scroll");
    }) ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
其他热门机构的滑动
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ListController.prototype.initSlider = function(){
    if($('.other-institutions').find('.item').length>1){
        require([this.utilStaticPrefix + "/jquery.slide.min.js"], function(){
            $(".other-institutions").slide({
                autoPlay : true ,
                titCell : ".header-pagination ul li" ,
                effect : "leftLoop" ,
                interTime : 4000 ,
                vis : 1            
            });
        }); 
    }else{
        $('.header-pagination ul').empty();
    }
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 类的初始化
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function () {
    new ListController;
});