function IndexController(){Controller.call(this),this.servicesCategory(),this.initDatePicker(),this.addResevePerson(),this.invoiceCheckListener(),this.couponListener(),this.submitForm(),this.ajaxSet()}IndexController.prototype.ajaxSet=function(){$.ajaxSetup({cache:!1}),$(".topper-service").load("/personal/toper/count",function(a){})},IndexController.prototype.initDatePicker=function(){var a=$(".datepicker").attr("data-input")?JSON.parse($(".datepicker").attr("data-input")):[];$(".date").datepicker({format:"yyyy-mm-dd",language:"zh-CN",todayHighlight:!1,autoclose:!0,startDate:$(".datepicker").attr("data-start"),endDate:"+60d",datesEnabled:a}),$("#reserveDate").val(""),$(".date").change(function(){var a=$(this);$("#reserveDate").val(a.find("input").val())})},IndexController.prototype.addResevePerson=function(){var a=this;require([a.utilStaticPrefix+"/validation/js/languages/jquery.validationEngine-zh_CN.js",a.utilStaticPrefix+"/validation/js/jquery.validationEngine.js"],function(){$("#chbName").click(function(){var a=$(this),b=a.is(":checked");b?$("#reportReceiver").parent(".form-group").slideUp():$("#reportReceiver").parent(".form-group").slideDown()}),$("#chbMobile").click(function(){var a=$(this),b=a.is(":checked");b?$("#reportReceiverPhoneNumber").parent(".form-group").slideUp():$("#reportReceiverPhoneNumber").parent(".form-group").slideDown()}),$("#idType").change(function(){var a=$(this),b=a.val();"1"===b?$("#idNumber").attr("data-validation-engine","validate[required,custom[idCard]]"):$("#idNumber").attr("data-validation-engine","validate[required]")}),$(".three-column >div").click(function(){var a=$(this);a.addClass("selected").siblings().removeClass("selected")}),$("#reseveMedical").validationEngine({promptPosition:"topLeft",autoHidePrompt:!0,autoHideDelay:5e3,showOneMessage:!0,maxErrorsPerField:1,validationEventTrigger:"",scroll:!1}),$("#btnAddPerson").click(function(){var b=$("#userName").val(),c=$("#chbName").is(":checked"),d=$("#phoneNumber").val(),e=$("#chbMobile").is(":checked"),f="",g="",h=$("#idType").val(),i=$("#idNumber").val(),j=$("#reportReceiver").val(),k=$("#reportReceiverPhoneNumber").val(),l=$("#reportReceiveAddr").val();c?j=b:"",e?k=d:"";var m=$(".three-column div.selected").attr("data-value");if(!m)return a.tips('<span class="text-danger">请选择性别！</span>',3),!1;"1"==m?(f=1,g=0):"2"==m?(f=0,g=0):"3"==m&&(f=0,g=1);var n=$("#reseveMedical").validationEngine("validate");if(!n)return!1;var o=parseInt($("#personNumber").val())+1,p={index:o,userName:b,chbName:c,phoneNumber:d,chbMobile:e,gender:f,married:g,idType:h,idNumber:i,reportReceiver:j,reportReceiverPhoneNumber:k,reportReceiveAddr:l};return a.deDuplication(p)?($("#personNumber").val(o),a.packageListData(p),a.generateTable(),void a.calculateAmount()):!1}),$(".person-list").on("click",'tr[class!="example"] .icon-shanchu1',function(){var b=$(this).parents("tr"),c=b.attr("data-index");a.confirm({content:"您确认要删除么？",confirmInterface:function(){a.packageListData({},c);var b=parseInt($("#personNumber").val());$("#personNumber").val(b-1),a.generateTable(),a.calculateAmount()}})})})},IndexController.prototype.deDuplication=function(a){for(var b=this,c=!0,d=$("#reserveListInfo").val()?JSON.parse($("#reserveListInfo").val()):[],e=0,f=d.length;f>e;e++)if(a.idType===d[e].idType&&a.idNumber===d[e].idNumber)return b.tips('<span class="text-danger">您已经添加过该体检人信息，请勿重复添加！</span>',5),c=!1;return c},IndexController.prototype.calculateAmount=function(){var a=this,b=parseFloat($("#unitPrice").val()),c=parseInt($(".person-list tbody tr[class!='example']").size()),d=parseInt($("#lblCouponAmount").attr("data-value")||0),e=b*c-d;$("#payInfoNumber").text(c),0>e&&0!=d?(e=b*c,$("#couponContent").hide(),$("#couponBox").show().find("input").val(""),a.tips("<span class='text-danger'>优惠码的抵扣金额为"+d+",大于实际支付金额！</span>",3,function(){$("#lblCouponCode").text(" ").attr("data-value",""),$("#lblCouponAmount").text(" ").attr("data-value",""),$("#promoteCodeInfo").val(""),$("#promoteCodeAmount").val(""),$(".amount").text(e.toFixed(2)),$("#totalPay").val(e.toFixed(2))})):($(".amount").text(e.toFixed(2)),$("#totalPay").val(e.toFixed(2))),$("#reserveNum").val(c)},IndexController.prototype.generateTable=function(){var a=$("#reserveListInfo").val()?JSON.parse($("#reserveListInfo").val()):[],b="";0==a.length&&(b+='<tr class="example"><td><a href="javascript:;" data-toggle="tooltip" data-placement="top" title="删除"><i class="iconfont icon-shanchu1"></i></a></td><td>1</td><td>示例</td><td>**************1125</td><td>*******6789</td><td>示例</td><td>*******6789</td><td>上海市徐汇区吴中东路555号</td></tr>');for(var c=0,d=a.length;d>c;c++)b+='<tr data-index = "'+a[c].index+'" data-value='+JSON.stringify(a[c])+">",b+='<td><a href="javascript:;" data-toggle="tooltip" data-placement="top" title="删除"><i class="iconfont icon-shanchu1"></i></a></td>',b+="<td>"+(c+1)+"</td>",b+="<td>"+a[c].userName+"</td>",b+="<td>"+a[c].idNumber+"</td>",b+="<td>"+a[c].phoneNumber+"</td>",b+="<td>"+a[c].reportReceiver+"</td>",b+="<td>"+a[c].reportReceiverPhoneNumber+"</td>",b+="<td>"+a[c].reportReceiveAddr+"</td>",b+="</tr>";$(".person-list table tbody").html(" ").append($(b)),$(".person-list tbody tr td a[data-toggle='tooltip']").tooltip(),$("#userName").val(""),$("#phoneNumber").val(""),$("#idNumber").val(""),$("#reportReceiver").val(""),$("#reportReceiverPhoneNumber").val(""),$("#reportReceiveAddr").val(""),$(".three-column div").removeClass("selected")},IndexController.prototype.invoiceCheckListener=function(){$("#invoiceCheck").click(function(){var a=$(this),b=a.is(":checked"),c=$.trim($("#lblInvoiceTitle").html());b?0===c.length?$(".invoiceBox").slideDown():$("#invoiceContent").slideDown():($("#iptTitle").val(""),$("#txtInvoiceAddress").val(""),$("#invoiceTitleType span").removeClass("selected"),$("#invoiceTitleType span:first").addClass("selected"),$("#invoiceContentType span").removeClass("selected"),$("#invoiceContentType span:first").addClass("selected"),$(".invoiceBox .errorMsg").hide(),$(".invoiceBox").hide(),$("#invoiceContent").hide())}),$(".tool-box .btn").click(function(){var a=$(this),b=a.attr("data-flag"),c=$.trim($("#lblInvoiceTitle").html());if("cancle"===b)0!=c.length?($(".invoiceBox").slideUp(),$("#invoiceContent").slideDown()):($("#iptTitle").val(""),$("#txtInvoiceAddress").val(""),$("#invoiceTitleType span").removeClass("selected"),$("#invoiceTitleType span:first").addClass("selected"),$("#invoiceContentType span").removeClass("selected"),$("#invoiceContentType span:first").addClass("selected"),$(".invoiceBox .errorMsg").hide(),$(".invoiceBox").hide(),$("#invoiceCheck").removeAttr("checked"));else{var d=$("#invoiceType").find("span.selected").attr("data-value"),e=$("#invoiceType").find("span.selected").attr("data-name"),f=$("#invoiceTitleType").find("span.selected").attr("data-value"),g=$("#invoiceTitleType").find("span.selected").attr("data-name"),h=$("#iptTitle").val(),i=$("#txtInvoiceAddress").val(),j=$("#invoiceContentType").find("span.selected").attr("data-name"),k=$("#invoiceContentType").find("span.selected").attr("data-value");if(""==h)return $("#iptTitle").next("span.errorMsg").show(),!1;if($("#iptTitle").next("span.errorMsg").hide(),""==i)return $("#txtInvoiceAddress").next("span.errorMsg").show(),!1;$("#txtInvoiceAddress").next("span.errorMsg").hide(),$(".invoiceBox").slideUp(),$("#invoiceContent #lblInvoiceType").text(e).attr("data-value",d),$("#invoiceContent #lblInvoiceTitleType").text(g).attr("data-value",f),$("#invoiceContent #lblInvoiceTitle").text(h),$("#invoiceContent #lblInvoiceAddress").text(i),$("#invoiceContent #lblInvoiceContentType").text(j).attr("data-value",k),$("dd#invoiceContent").show();var l={type:d,titleType:f,title:h,address:i,content:k};$("#checkInfo").val(JSON.stringify(l))}}),$("#invoiceContent a[data-flag='edit']").click(function(){var a=$(this),b=($("#lblInvoiceType").attr("data-value"),$("#lblInvoiceTitleType").attr("data-value")),c=$.trim($("#lblInvoiceTitle").html()),d=$.trim($("#lblInvoiceAddress").html()),e=$("#lblInvoiceContentType").attr("data-value");$("#iptTitle").val(c),$("#txtInvoiceAddress").val(d),$("#invoiceTitleType span").removeClass("selected"),$("#invoiceTitleType").find("span[data-value='"+b+"']").addClass("selected"),$("#invoiceContentType span").removeClass("selected"),$("#invoiceContentType").find("span[data-value='"+e+"']").addClass("selected"),a.parents("dd").hide(),$(".invoiceBox").slideDown()}),$(".invoiceBox dd span").click(function(){var a=$(this);a.addClass("selected").siblings("span").removeClass("selected")})},IndexController.prototype.couponListener=function(){var a=this;$("#promoCheck").click(function(){var b=$(this),c=b.is(":checked");$("#couponBox input").val(""),c?$("#couponBox").slideDown():($("#couponBox").slideUp(),$("#couponContent").slideUp(),$("#lblCouponCode").text("").attr("data-value",""),$("#lblCouponAmount").attr("data-value",0),$("#promoteCodeInfo").val(""),$("#promoteCodeAmount").val(0),a.calculateAmount())}),$("#couponBox .input-group-addon").click(function(){var b=$("#couponBox input").val();if(!b||""==b)return a.tips('<span class="text-danger">请输入正确的优惠码</span>',3),!1;if(!/^\d*$/g.test(b))return a.tips('<span class="text-danger">无效的优惠码</span>',3),!1;var c={process:function(b){b.result?($("#couponBox").hide(),$("#couponContent").show(),$("#lblCouponCode").text($.trim($("#couponBox input").val())).attr("data-value",$.trim($("#couponBox input").val())),$("#lblCouponAmount").text(parseFloat(b.result.promoAmt)).attr("data-value",parseFloat(b.result.promoAmt)),$("#promoteCodeInfo").val($.trim($("#couponBox input").val())),$("#promoteCodeAmount").val(parseFloat(b.result.promoAmt)),a.calculateAmount()):a.tips('<span class="text-danger">无效的优惠码</span>',3)},onExceptionInterface:function(a,b){}};a.request(a.promoteCodeApiUrl,{pcode:b},c)}),$("#couponContent a").click(function(){$("#couponContent").hide(),$("#couponBox").show().find("input").val(""),$("#lblCouponCode").text(" ").attr("data-value",""),$("#lblCouponAmount").text(" ").attr("data-value",""),$("#promoteCodeInfo").val(""),$("#promoteCodeAmount").val(""),a.calculateAmount()})},IndexController.prototype.packageListData=function(a,b){var c=$("#reserveListInfo").val()?JSON.parse($("#reserveListInfo").val()):[],d=!1;for(var e in a){d=!0;break}if(d&&c.push(a),b)for(var f=0,g=c.length;g>f;f++)if(c[f].index==b){c.splice(f,1);break}var h=c.length?JSON.stringify(c):"";$("#reserveListInfo").val(h)},IndexController.prototype.submitForm=function(){var a=this;$("#submitForm button").on("click",function(){if(0===$("#reserveDate").val().length)return a.tips('<span class="text-danger">请先选择预约日期！</span>',3),!1;if(0===$("#reserveListInfo").val().length)return a.tips('<span class="text-danger">请先登记体检人信息！</span>',3),!1;var b={sId:$("input[name='sId']").val(),pId:$("input[name='pId']").val(),bookingStoreDate:$("input[name='bookingStoreDate']").val(),quantity:$("input[name='quantity']").val(),amount:$("input[name='amount']").val(),invoice:$("input[name='invoice']").val(),promoCode:$("input[name='promoCode']").val(),promoCodeChargeAmt:$("input[name='promoCodeChargeAmt']").val(),customer:$("input[name='customer']").val()};return a.request($("#submitForm").attr("action"),b,{process:function(a){window.location.href=a.result.redirect}}),ga("send","event","bodyck","gopay","马上支付体检"),!1})},$(document).ready(function(){new IndexController});