function Reserve(a){Controller.call(this),this.init(),this.submitForm(a)}Reserve.prototype.init=function(){$(".btn-reserve").click(function(a){officeHoursPart=[];var b=$(".des").find(".store-time").html();startTime=b.substring(0,b.indexOf("-")),endTime=b.substring(b.indexOf("-")+1,b.indexOf("-")+6),officeHoursPart.push(startTime,endTime),$.each(officeHoursPart,function(a,b){"00"!=b.split(":")[1]?0==a?startOfficeHours=Number(b.split(":")[0])+1:endOfficeHours=Number(b.split(":")[0])+1:0==a?startOfficeHours=Number(b.split(":")[0]):endOfficeHours=Number(b.split(":")[0])}),PartTimeNum=endOfficeHours-startOfficeHours}),$("#btnReserve").prop("disabled",!0);var a=0,b="",c=$("#datepicker").attr("data-date"),d=[],e=new Date(c).add(2).months().toString("yyyy/M/d");if($("#J_disabled").length&&""!==$("#J_disabled").val()){var f=$("#J_disabled").val().split(","),g=f[0].split("/"),h=f[1].split("/"),i=g[0],j=(g[1],g[1]-1),k=h[1]-1,l=f[0].split("/")[2],m=f[1].split("/")[2],n=new Date,o=new Date;n.setFullYear(i,j,l),o.setFullYear(i,k,m),d=[n,o]}var p=new Date,q=new Date;d.push(p),$("#datepicker").datepicker({format:"yyyy/mm/dd",language:"zh-CN",startDate:c,endDate:e,datesDisabled:d}).on("changeDate",function(){console.log(PartTimeNum),q.getDate()!=Number($("#datepicker .datepicker-days tbody").find(".active").html())&&$("#btnReserve").prop("disabled",!1),$("#module-reserve .date #datepicker").css("padding","0 0 10px"),$("#datepicker").css("width","305px"),$(".date h3").html("选择时段"),$("#hiddenDate").val($("#datepicker").datepicker("getFormattedDate"));for(var c=$("#datepicker .datepicker-days thead tr").eq(1).children("th").eq(1).html(),d=$("#datepicker .datepicker-days tbody").find(".active").html(),e=$("#datepicker .datepicker-days tbody tr").find(".active").parent("tr").children(),f=0;f<e.length;f++)if(e.eq(f).hasClass("active"))var g=f+1;if(1==g?b="星期一":2==g?b="星期二":3==g?b="星期三":4==g?b="星期四":5==g?b="星期五":6==g?b="星期六":7==g&&(b="星期日"),$(".datepicker-inline").hide(),0==a){$("#datepicker").append('<h4 id="adBack" style=""><i class="backDate "><</i>'+c+d+"号 "+b+"</h4>");var h=$(document.createElement("SELECT")).attr("id","sel").css({width:"200px",height:"20px",display:"block",margin:"0 auto",color:"#000000"}),i="";if(PartTimeNum)for(var j=0;j<PartTimeNum;j++)startOfficeHours=Number(startOfficeHours),startOfficeHours<10&&(startOfficeHours="0"+startOfficeHours),console.log(startOfficeHours),i+="<option>"+startOfficeHours+":00-",startOfficeHours=Number(startOfficeHours),startOfficeHours++,startOfficeHours<10&&(startOfficeHours="0"+startOfficeHours),i+=startOfficeHours+":00</option>";else for(var j=8;22>j;j++){var k=j+1;10>j&&(j="0"+j),10>k&&(k="0"+k),i+="<option>"+j+":00-",i+=k+":00</option>"}h.append(i),$("#datepicker").append(h);for(var l=0;l<$("#sel").children("option").length;l++)$("#sel").children("option").eq(l).prop("selected")&&(console.log($("#sel").children("option:selected").eq(l).html()),$("#bookingEndTime").val($("#sel").children("option:selected").eq(l).html()));$("#bookingEndTime").val($("#sel").children("option:selected").html()),a++}else $("#datepicker h4").html('<span class="backDate">&lt;&lt;</span>'+c+d+"号 "+b),$("#datepicker #sel").show(),$("#datepicker h4").show();for(var m=0;m<$("#sel").children("option").length;m++)$("#sel").children("option").eq(m).prop("selected")&&(console.log($("#sel").children("option:selected").eq(m).html()),$("#bookingEndTime").val($("#sel").children("option:selected").eq(m).html()))})},Reserve.prototype.addListenerToStoreList=function(){$("#storeId").val($(".selected-label").attr("data-id")),$("#module-reserve .dropdown-menu li").click(function(){var a=$(this),b=a.attr("data-id"),c=$(a.find("a").html());$(".selected-label").attr("data-id",b).html(" ").append(c),$("#storeId").val($(".selected-label").attr("data-id"))})},Reserve.prototype.submitForm=function(a){function b(a){$("input[name='pnum']").val(a);var b=$("#discountedPrice").val();if(parseFloat(b)>0){var c=parseFloat(b)*a;c=c.toString().indexOf(".")?Math.floor(100*c)/100:c,$(".price").find(".amount").text(c)}}if(0===$("#btnReserve").size())return 0;var c=this;$(".add").click(function(){var a=parseInt($("input[name='pnum']").val());9999>=a&&(a++,b(a))}),$(".min").click(function(){var a=parseInt($("input[name='pnum']").val());a>1&&(a--,b(a))}),$("[name='pnum']").blur(function(){var a=parseInt($(this).val());a>0&&1e4>a&&b(a)}),$("#btnReserve").click(function(){var b=$(this);b.addClass("disabled").html("正在提交数据...");var d={bookingDate:$.trim($("#hiddenDate").val()),shopId:$("#shopSelector").find(".dropdown-menu li[data-selected='selected']").attr("data-id"),count:$.trim($("input[name='pnum']").val()),productId:$.trim($("#productId").val()),bookingOrigin:$.trim($("#bookingOrigin").val()),bookEndTime:$.trim($("#bookingEndTime").val())},e={type:"POST",process:function(a){a.result&&a.result.redirect?window.location.href=a.result.redirect:($("#module-reserve").modal("hide"),c.reserveSuccessCallback())},onExceptionInterface:function(c){b.removeClass("disabled").html("确定预约"),"911"===c.code.toString()&&($(".toper .pull-right a").remove(),$(".toper .pull-right").append("<a id='toperLogin' href='/login'>登录</a><a id='toperRegister' href='/register'>注册</a>"),$("#module-reserve").modal("hide"),a.popUpAccoountModule())}};c.request(c.reserveApiUrl,d,e)})},Reserve.prototype.reserveSuccessCallback=function(){var a=this;0===$("#module-reserveSuccess").size()?a.dialog({tabindex:2,id:"module-reserveSuccess",effect:!1,url:"/product/booking/success"}):$("#module-reserveSuccess").modal("show")},$(function(){new Reserve});