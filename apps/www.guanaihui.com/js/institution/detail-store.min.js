function DetailsController(){Controller.call(this),this.servicesCategory(),this.floater(),this.rollImg(),this.chooseAreaListener(),this.storeClickListener(),this.pageChangeListener(),this.loadStoreAndService({pageIndex:1,companyId:$("#companyId").val(),firstloadId:storeId}),this.cliclkMap()}DetailsController.prototype.rollImg=function(){$(".slider-for").slick({autoplay:!0,slidesToShow:1,slidesToScroll:1,arrows:!0,fade:!0,asNavFor:".slider-nav",prevArrow:'<a href="javascript:;" class="prev"><i class="iconfont icon-fanhui"></i></a>',nextArrow:'<a href="javascript:;" class="next"><i class="iconfont icon-xiangyou3"></i></a>'});var a=$(".slider-for img").size()>5;a?$(".slider-nav img").css("height","60px"):$(".slider-nav img").attr("style","width:100px !important"),$(".slider-nav").slick({slidesToShow:5,slidesToScroll:1,asNavFor:".slider-for",dots:!1,arrows:!1,focusOnSelect:!0,centerMode:a}),$(".slider-nav").addClass("opClass"),$(".slick-arrow").addClass("opClass"),$(".slider-for,.slider-nav").mouseover(function(){$(".slider-nav").removeClass("opClass"),$(".slick-arrow").removeClass("opClass")}),$(".slider-for,.slider-nav").mouseout(function(){$(".slider-nav").addClass("opClass"),$(".slick-arrow").addClass("opClass")})},DetailsController.prototype.calculateHeight=function(){var a=$(".store-list").outerHeight(),b=$(".service-item").outerHeight(),c=a>b?a:b;$(".store-service").height(c),$(".service-list").height(c)},DetailsController.prototype.storeAndServiceSlide=function(){var a=this;require([a.utilStaticPrefix+"/jquery.slide.min.js"],function(){$(".service-item").slide({autoPlay:!1,titCell:".pagination ul li",effect:"leftLoop",interTime:4e3,vis:1}),a.calculateHeight()})},DetailsController.prototype.chooseAreaListener=function(){var a=this;$("#areaselect").change(function(){var b=$(this),c=b.find("option:selected").attr("value"),d=1,e={areaId:c,pageIndex:d,companyId:$("#companyId").val()};a.loadStoreAndService(e)})},DetailsController.prototype.pageChangeListener=function(){var a=this;$(".store-list .page .item a").click(function(){var b=$(this),c=$("#areaselect").find("option:selected").attr("value"),d=$(".page .item").attr("data-currentpage"),e=$(".page .item").attr("data-pages"),f=$("#companyId").val();b.hasClass("prev")?d=1==d?1:d-1:b.hasClass("next")?d=d==e?e:parseInt(d)+1:b.hasClass("first")?d=1:b.hasClass("end")&&(d=e),$(".page .item").attr("data-currentpage",d);var g={areaId:c,pageIndex:d,companyId:f};a.loadStoreAndService(g)})},DetailsController.prototype.loadStoreAndService=function(a){var b=this,a=a||{};b.loadStore(a),b.storeAndServiceSlide(),b.storeClickListener();var c={};if($(".store-item").length>0){var d=$(".store-item.active");c.name=d.attr("data-name"),c.address=d.attr("data-address"),c.longitude=d.attr("data-longitude"),c.latitude=d.attr("data-latitude"),c.busTips=d.attr("data-busTips"),c.subwayTips=d.attr("data-subwayTips"),c.parkingDetail=d.attr("data-parkingDetail")}b.createMap(c),console.log("Load was performed.")},DetailsController.prototype.loadProduct=function(a){var b="",c=a.result.length;if(c>0){var d=0;b+='<div class="service-item">',c>3&&(b+='<div class="controller prev"><i class="iconfont icon-fanhui"></i></div>',b+='<div class="controller next"><i class="iconfont icon-xiangyou3"></i></div>'),b+='<div class="content">';for(var e=0;c/3>e;e++){b+='<div class="item"><ul class="checkItemList">';for(var f=0;3>f;f++){if(c>d){var g=a.result[d].discountedPrice<=0?"免费":a.result[d].discountedPrice,h=a.result[d].discountedPrice<=0?"":'<span class="money-icon">￥</span><span>';b+='<li><a href="/Html/GuanaihuiProduct/'+a.result[d].productId+".html?sid="+storeId+'"><img src="'+setting.VAR_API_URL+a.result[d].logo+'list.jpg" alt="'+a.result[d].name+'" /><div class="item-price">',b+="<p>"+h+g+'</span></p><p><span class="money-icon">￥</span><span>'+a.result[d].retailedPrice+"</span></p><p>查看详情</p></div>",b+='<div class="item-content"><h4>'+a.result[d].name+"</h4><p>"+a.result[d].productgroup+"</p></div></a></li>"}d++}b+="</ul></div>"}if(c>3){b+='</div><div class="pagination"><ul>';for(var e=0;c/3>e;e++){var i="";0==e&&(i='class="on"'),b+="<li "+i+"></li>"}b+="</ul></div></div>"}var j=$(b);$(".service-list .service-item").remove(),$(".service-list").append(j)}else{b+='<div class="service-item"><ul class="checkItemList"><li class="empty"><a href="javascript:;"><img src="//dev18.guanaihui.cn/apps/www.guanaihui.com/css/images/institution-default.jpg" style="width:100%" /></a></li></ul></div>';var j=$(b);$(".service-list .service-item").remove(),$(".service-list").append(j)}},DetailsController.prototype.loadStore=function(a){var b=this,c=stores.filter(function(b,c){return!a.areaId||b.AreaId==a.areaId});$("#totalcount").text("共"+c.length+"家门店");var d=Math.ceil(c.length/5);$(".page .item").attr("data-pages",d),d>1?$("div.page").show():$("div.page").hide(),c=c.filter(function(b,c){return c>=5*(a.pageIndex-1)&&c<5*a.pageIndex});var e="",f=c.length;if(f>0){a.pageIndex>1?($("#currentpage").text(5*(a.pageIndex-1)+"-"+(5*(a.pageIndex-1)+f)),$(".store-list .page .item a.prev").removeClass("disabled")):($("#currentpage").text("1-"+f),$(".store-list .page .item a.prev").addClass("disabled")),a.pageIndex==d?($(".store-list .page .item a.next").addClass("disabled"),a.pageIndex>1?($(".store-list .page .item a.first ").removeClass("on"),$(".store-list .page .item a.end ").addClass("on")):$("div.page").hide()):($(".store-list .page .item a.next").removeClass("disabled"),1==a.pageIndex?($(".store-list .page .item a.end ").removeClass("on"),$(".store-list .page .item a.first ").addClass("on")):($(".store-list .page .item a.end ").removeClass("on"),$(".store-list .page .item a.first ").removeClass("on")));for(var g=0;f>g;g++){var h=0==g?" active ":"";e+="<div class='store-item"+h+"' data-id='"+c[g].StoreId+"' data-name='"+c[g].StoreName+"' data-address='"+c[g].Address+"' data-longitude='"+c[g].Longitude+"' data-latitude='"+c[g].Latitude+"' data-busTips='"+c[g].BusTips+"' data-subwayTips='"+c[g].Subway+"' data-parkingDetail='"+c[g].Park+"'> <dl><dt><h3>"+c[g].StoreName+"</h3><p>"+c[g].Address+"<i data-toggle='modal' class='iconfont'>&#xe804;</i></p></dt><dd><p>营业时间 : "+c[g].Nonworkdays+" </p><p>抽血时间 : "+c[g].BloodTime+"</p></dd></dl></div>"}var i=$(e);$(".store-list .store-item").remove(),$(".store-list").prepend(i),$(".store-service").attr("style",""),$(".store-list").attr("style","");var j=$(".store-list").outerHeight()+40;$(".store-list").height(j),a.firstloadId&&(storeId=a.firstloadId,c=stores.filter(function(a,b){return a.StoreId==storeId}),$(".store-item:not(.active)[data-id="+storeId+"]").addClass("active").siblings(".store-item").removeClass("active")),c[0]&&(storeId=c[0].StoreId,b.loadProduct({result:c[0].Products}))}else{var i=$(e);$(".store-list .store-item").remove()}},DetailsController.prototype.storeClickListener=function(){var a=this;$("body").off("click",".store-item:not(.active)").on("click",".store-item:not(.active)",function(){var b=$(this);storeId=b.attr("data-id"),b.addClass("active").siblings(".store-item").removeClass("active");var c=stores.filter(function(a,b){return a.StoreId==storeId});c[0]&&(storeId=c[0].StoreId,a.loadProduct({result:c[0].Products}),a.storeAndServiceSlide())}),$(".special-service").on("click",".store-item dt p i",function(){var b=$(this);$("#myModal").on("shown.bs.modal",function(c){var d=b.closest(".store-item"),e={name:d.attr("data-name"),address:d.attr("data-address"),longitude:d.attr("data-longitude"),latitude:d.attr("data-latitude"),busTips:d.attr("data-busTips"),subwayTips:d.attr("data-subwayTips"),parkingDetail:d.attr("data-parkingDetail")};a.createMap(e)}),$("#myModal").modal()})},DetailsController.prototype.createMap=function(a){var b=this;point=new BMap.Point(a.longitude,a.latitude),map=new BMap.Map("baiduMapContainer"),map.centerAndZoom(point,15),marker=new BMap.Marker(point),map.addOverlay(marker),marker.setAnimation(BMAP_ANIMATION_BOUNCE);var c=new BMap.InfoWindow("            <dl>                <dt>机构：</dt>                <dd>"+a.name+"</dd>            </dl>            <dl>                <dt>地址：</dt>                <dd>"+a.address+"</dd>            </dl>            <dl>                <dt><img src ="+b.staticDomain+"/apps/www.guanaihui.com/css/images/icon-park.jpg></dt>                <dd>"+a.parkingDetail+"</dd>            </dl>            <dl>                <dt><img src ="+b.staticDomain+"/apps/www.guanaihui.com/css/images/icon-metro.jpg></dt>                <dd>"+a.subwayTips+"</dd>            </dl>             <dl>                <dt><img src ="+b.staticDomain+"/apps/www.guanaihui.com/css/images/icon-bus.jpg></dt>                <dd>"+a.busTips+"</dd>            </dl>            ",{padding:10,width:320});marker.addEventListener("click",function(){this.openInfoWindow(c)}),map.addControl(new BMap.MapTypeControl),map.enableScrollWheelZoom(!1),map.addControl(new BMap.NavigationControl),map.addControl(new BMap.ScaleControl),map.addControl(new BMap.OverviewMapControl),map.addControl(new BMap.MapTypeControl),map.panTo(point)},DetailsController.prototype.cliclkMap=function(){var a=this;$(".special-service").on("click",".store-item dt p i",function(){var b=$(this);$("#myModal").on("shown.bs.modal",function(c){var d=b.closest(".store-item");console.log(d);var e={name:d.attr("data-name"),address:d.attr("data-address"),longitude:d.attr("data-longitude"),latitude:d.attr("data-latitude"),busTips:d.attr("data-busTips"),subwayTips:d.attr("data-subwayTips"),parkingDetail:d.attr("data-parkingDetail")};a.createMap(e)}),$("#myModal").modal()})},$(function(){new DetailsController});