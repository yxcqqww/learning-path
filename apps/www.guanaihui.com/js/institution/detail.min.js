function DetailsController(){Controller.call(this),this.servicesCategory(),this.floater(),this.rollImg(),this.chooseAreaListener(),this.loadStoreAndService({companyId:$("#companyId").val(),shopId:$("#shopId").val()}),this.cliclkMap(),this.ajaxSet(),this.fixPo()}DetailsController.prototype.rollImg=function(){$(".slider-for").slick({autoplay:!0,slidesToShow:1,slidesToScroll:1,arrows:!0,fade:!0,asNavFor:".slider-nav",prevArrow:'<a href="javascript:;" class="prev"><i class="iconfont icon-fanhui"></i></a>',nextArrow:'<a href="javascript:;" class="next"><i class="iconfont icon-xiangyou3"></i></a>'});var a=$(".slider-for img").size()>5;a?$(".slider-nav img").css("height","60px"):$(".slider-nav img").attr("style","width:100px !important"),$(".slider-nav").slick({slidesToShow:5,slidesToScroll:1,asNavFor:".slider-for",dots:!1,arrows:!1,focusOnSelect:!0,centerMode:a}),$(".slider-nav").addClass("opClass"),$(".slick-arrow").addClass("opClass"),$(".slider-for,.slider-nav").mouseover(function(){$(".slider-nav").removeClass("opClass"),$(".slick-arrow").removeClass("opClass")}),$(".slider-for,.slider-nav").mouseout(function(){$(".slider-nav").addClass("opClass"),$(".slick-arrow").addClass("opClass")})},DetailsController.prototype.calculateHeight=function(){var a=$(".store-list").outerHeight()+40,b=$(".service-item").outerHeight(),c=a>b?a:b;$(".store-service").height(c),$(".service-list").height(c)},DetailsController.prototype.storeAndService=function(){var a=this;require([a.utilStaticPrefix+"/jquery.slide.min.js"],function(){$(".service-item").slide({autoPlay:!1,titCell:".pagination ul li",effect:"leftLoop",interTime:4e3,vis:1}),a.calculateHeight()})},DetailsController.prototype.chooseAreaListener=function(){var a=this;$(".select-area").change(function(){var b=$(this),c=b.find("option:selected").attr("value"),d={areaId:c,pageIndex:1,companyId:$("#companyId").val(),shopId:$("#shopId").val()};a.loadStoreAndService(d)})},DetailsController.prototype.pageChangeListener=function(){var a=this;$(".store-list .page .item a").click(function(){var b=$(this),c=$(".select-area").find("option:selected").attr("value"),d=b.attr("data-index"),e=$("#companyId").val(),f={areaId:c,pageIndex:d,companyId:e,shopId:$("#shopId").val()};a.loadStoreAndService(f)})},DetailsController.prototype.loadStoreAndService=function(a){var b=this,a=a||{};a.isPrev="prev"===$(".store-service").attr("data-flag"),$(".store-service").load("/company/shop/list",a,function(){b.storeAndService(),b.storeClickListener(),b.pageChangeListener();var a={};if($(".store-item").length>0){var c=$(".store-item.active");a.name=c.attr("data-name"),a.address=c.attr("data-address"),a.longitude=c.attr("data-longitude"),a.latitude=c.attr("data-latitude"),a.busTips=c.attr("data-busTips"),a.subwayTips=c.attr("data-subwayTips"),a.parkingDetail=c.attr("data-parkingDetail")}b.createMap(a),console.log("Load was performed.")})},DetailsController.prototype.storeClickListener=function(){var a=this;$("body").off("click",".store-item:not(.active)").on("click",".store-item:not(.active)",function(){var b=$(this),c=b.attr("data-id");b.addClass("active").siblings(".store-item").removeClass("active");var d={shopId:c,companyId:$("#companyId").val()};$(".service-list").load("/company/prod/data",d,function(){a.storeAndService()})})},DetailsController.prototype.cliclkMap=function(){var a=this;$(".special-service").on("click",".store-item dt p i",function(){var b=$(this);$("#myModal").on("shown.bs.modal",function(c){var d=b.closest(".store-item"),e={name:d.attr("data-name"),address:d.attr("data-address"),longitude:d.attr("data-longitude"),latitude:d.attr("data-latitude"),busTips:d.attr("data-busTips"),subwayTips:d.attr("data-subwayTips"),parkingDetail:d.attr("data-parkingDetail")};a.createMap(e)}),$("#myModal").modal()})},DetailsController.prototype.createMap=function(a){var b=this;point=new BMap.Point(a.longitude,a.latitude),map=new BMap.Map("baiduMapContainer"),map.centerAndZoom(point,15),marker=new BMap.Marker(point),map.addOverlay(marker),marker.setAnimation(BMAP_ANIMATION_BOUNCE);var c=new BMap.InfoWindow("        <dl>            <dt>机构：</dt>            <dd>"+a.name+"</dd>            </dl>            <dl>                <dt>地址：</dt>                <dd>"+a.address+"</dd>            </dl>            <dl>                <dt><img src ="+b.staticDomain+"/apps/www.guanaihui.com/css/images/icon-park.jpg></dt>                <dd>"+a.parkingDetail+"</dd>            </dl>            <dl>                <dt><img src ="+b.staticDomain+"/apps/www.guanaihui.com/css/images/icon-metro.jpg></dt>                <dd>"+a.subwayTips+"</dd>            </dl>             <dl>                <dt><img src ="+b.staticDomain+"/apps/www.guanaihui.com/css/images/icon-bus.jpg></dt>                <dd>"+a.busTips+"</dd>            </dl>            ",{padding:10,width:320});marker.addEventListener("click",function(){this.openInfoWindow(c)}),map.addControl(new BMap.MapTypeControl),map.enableScrollWheelZoom(!1),map.addControl(new BMap.NavigationControl),map.addControl(new BMap.ScaleControl),map.addControl(new BMap.OverviewMapControl),map.addControl(new BMap.MapTypeControl),map.panTo(point)},DetailsController.prototype.ajaxSet=function(){$.ajaxSetup({cache:!1}),$(".topper-service").load("/personal/toper/count",function(a){})},DetailsController.prototype.fixPo=function(){if($(".template-nav")[0]){var a=function(a){$(".template-body .tl-box").eq(6)[0]&&$(this).scrollTop()<=$(".template-body .tl-box").eq(6).offset().top&&$(this).scrollTop()>=$(".template-body .tl-box").eq(5).offset().top-80||$(".template-body .tl-box").eq(5)[0]&&$(this).scrollTop()>=$(".template-body .tl-box").eq(5).offset().top-50?($(".template-nav li").eq(5).addClass("in").siblings("li").removeClass("in"),$(".template-nav").addClass("fixName")):$(".template-body .tl-box").eq(5)[0]&&$(this).scrollTop()<=$(".template-body .tl-box").eq(5).offset().top&&$(this).scrollTop()>=$(".template-body .tl-box").eq(4).offset().top-80||$(".template-body .tl-box").eq(4)[0]&&$(this).scrollTop()>=$(".template-body .tl-box").eq(4).offset().top-50?($(".template-nav li").eq(4).addClass("in").siblings("li").removeClass("in"),$(".template-nav").addClass("fixName")):$(".template-body .tl-box").eq(4)[0]&&$(this).scrollTop()<=$(".template-body .tl-box").eq(4).offset().top&&$(this).scrollTop()>=$(".template-body .tl-box").eq(3).offset().top-80||$(".template-body .tl-box").eq(3)[0]&&$(this).scrollTop()>=$(".template-body .tl-box").eq(3).offset().top?($(".template-nav li").eq(3).addClass("in").siblings("li").removeClass("in"),$(".template-nav").addClass("fixName")):$(".template-body .tl-box").eq(3)[0]&&$(this).scrollTop()<=$(".template-body .tl-box").eq(3).offset().top&&$(this).scrollTop()>=$(".template-body .tl-box").eq(2).offset().top-80?($(".template-nav li").eq(2).addClass("in").siblings("li").removeClass("in"),$(".template-nav").addClass("fixName")):$(this).scrollTop()<=$(".template-body .tl-box").eq(2).offset().top&&$(this).scrollTop()>=$(".template-body .tl-box").eq(1).offset().top-80?($(".template-nav li").eq(1).addClass("in").siblings("li").removeClass("in"),$(".template-nav").addClass("fixName")):$(this).scrollTop()<=$(".template-body .tl-box").eq(1).offset().top&&$(this).scrollTop()>=$(".template-body .tl-box").eq(0).offset().top-80?($(".template-nav li").eq(0).addClass("in").siblings("li").removeClass("in"),$(".template-nav").addClass("fixName")):$(this).scrollTop()>=$(".template-body .tl-box").eq(0).offset().top?($(".template-nav").addClass("fixName"),$(".template-nav li").eq(0).addClass("in").siblings("li").removeClass("in")):$(".template-nav").removeClass("fixName")};$(window).scroll(a);var b=!0;$(".template-nav li").click(function(c){$(window).unbind("scroll"),$(this).addClass("in").siblings("li").removeClass("in");var d=$(this).index();if(console.log($(".template-body .tl-box").eq(d).offset().top),$(".template-nav").hasClass("fixName"))if(0==d){var e=$(".template-body .tl-box").eq(d).offset().top-20;$("body,html").animate({scrollTop:e},500,function(){$(window).bind("scroll",a)})}else{var e=$(".template-body .tl-box").eq(d).offset().top-50;$("body,html").animate({scrollTop:e},500,function(){$(window).bind("scroll",a)})}else if(b=!0){var e=$(".template-body .tl-box").eq(d).offset().top-100;$("body,html").animate({scrollTop:e},500,function(){$(window).bind("scroll",a)}),b=!1}else{var e=$(".template-body .tl-box").eq(d).offset().top-50;$("body,html").animate({scrollTop:e},500,function(){$(window).bind("scroll",a)})}})}},$(document).ready(function(){new DetailsController});