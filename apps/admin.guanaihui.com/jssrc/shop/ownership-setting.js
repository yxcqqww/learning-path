/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：admin.guanaihui.com
 2. 页面名称：shop/ownership(机构->关爱体检通新增门店列表,设置归属机构)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function OwnershipSettingController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    实例化bootstrap-switch
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.instanceSwitch();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    实例化select2
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.instanceSelect2();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    设置归属机构提交
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.setOwnerShip();
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
实例化bootstrap-switch
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
OwnershipSettingController.prototype.instanceSwitch = function() {
    var classSelf = this;
    require([this.bootstrapStaticPrefix + "/plugins/bootstrap-switch/dist/js/bootstrap-switch.min.js"], function() {
        var $handle = $("input[name='headFlag']");
        $handle.bootstrapSwitch({
            "size": "small",
            "onText": "是",
            "offText": "否"
        });
        $handle.on("switchChange.bootstrapSwitch", function(e, data) {
            $handle.val(data);
        });
    });
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
实例化bootstrap-switch
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
OwnershipSettingController.prototype.instanceSelect2 = function() {
    var classSelf = this;
    var $handle = $("select[name='companyId']");
    $handle.select2({
        dropdownParent: $('.modal'),
        width: '100%',
        placeholder: "请选择所属机构"
    });
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
保存按钮
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
OwnershipSettingController.prototype.setOwnerShip = function() {
    var classSelf = this;
    $("#newStoreOwnerShipForm #save").click(function() {
        var id = $("#modal-branch input[name='id']").val(),
            name = $("#modal-branch input[name='name']").val(),
            companyId = $("#modal-branch select[name='companyId']").val(),
            headFlag = $("#modal-branch input[name='headFlag']").val();
        var ownerShipData = {
            "id": id,
            "name": name,
            "companyId": companyId,
            "headFlag": headFlag
        };
        console.log(ownerShipData);
        classSelf.request(classSelf.apiUrl.shop.ownership.setOwnerShip, ownerShipData, {
            process: function() {
                //reload页面
                window.location.reload();
            }
        });
    });
};
