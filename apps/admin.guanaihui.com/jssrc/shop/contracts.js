/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：admin.guanaihui.com
 2. 页面名称：shop/contracts(商户->合同列表)
 3. 作者：赵华刚(zhaohuagang@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function ContractsController() {
    this.quickPanel = $(".data-panel .quick-panel") ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this) ;     
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    事件绑定
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.bind() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    点击路径导航中的商户管理链接
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.backCompanyList() ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
实例化合同面板
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ContractsController.prototype.instanceQuickPanel = function() {
    var classSelf = this ;
    require([this.appStaticPrefix + "/shop/contract.min.js"], function(){
        new ContractController({
            quickPanel : classSelf.quickPanel ,
            parentClass : classSelf
        }) ;
    }) ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
事件绑定
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ContractsController.prototype.bind = function() {
    var classSelf = this ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    新增合同按钮
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(".data-panel .assistant .tools .add").click(function(){
        $(classSelf.quickPanel).attr("action", classSelf.apiUrl.shop.contracts.add) ;
        classSelf.swapPanel(this) ;        
    }) ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    编辑和作废按钮
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(".data-panel table tbody tr").each(function(){
        var id= $(this).attr("data-id") ;
        $(this).find(".edit").click(function(){
            $(classSelf.quickPanel).attr("action", classSelf.apiUrl.shop.contracts.edit) ;
            classSelf.swapPanel(this) ; 
        }) ;
    }) ;
    $(".data-panel table tbody tr").each(function(){
        var id= $(this).attr("data-id") ;
        $(this).find(".remove").click(function(){
            classSelf.cancel(id) ;
        }) ;
    }) ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
合同作废处理
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ContractsController.prototype.cancel = function(id) {
    var classSelf = this ;
    this.confirm({
        "content" : "您确定要作废合同吗？" ,
        "confirmInterface" : function() {            
            classSelf.request(classSelf.apiUrl.shop.contracts.cancel,  {
                "id" : id
            }, {
                process : function() {
                    classSelf.tips("合同作废成功！", 2, function(){
                        window.location.reload() ;
                    }) ;                    
                }
            }) ;
        } 
    }) ;
    
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
门店面板的弹出或者收起
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ContractsController.prototype.swapPanel = function(handle) {
    var classSelf = this ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    先清空表单内容
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(this.quickPanel).empty() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    然后再将页面异步加载进来并slideDown
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(this.quickPanel).load($(handle).attr("data-href"), function(){
        classSelf.instanceQuickPanel() ;
        $(this).slideDown(200) ;
    }) ;    
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的初始化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function() {
    new ContractsController ;
});
