/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：admin.guanaihui.com
 2. 页面名称：shop/ownership(机构->关爱体检通新增门店列表)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function OwnershipController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    实例化dialog
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.instanceDialog();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    实例化条理化表格
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    if ($(".data-panel table thead .handle").size() > 0) this.instanceMethodizeTable();
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
实例化dialog
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
OwnershipController.prototype.instanceDialog = function() {
    var classSelf = this;
    require([this.appStaticPrefix + "/shop/ownership-setting.min.js"], function() {
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        所有dialog句柄点击弹出目标页面
         -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(".dialog-handle").click(function() {
            var shopId = $(this).parents("tr").attr("data-id"),
                titleName = $(this).parents("tr").find("td").first().text();
            classSelf.dialog({
                "id": $(this).attr("data-dialog-id"),
                "url": encodeURI($(this).attr("data-href")),
                "dimension": "md"
            });
            /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
            品牌dialog实例化后要实例化tagswitch
             -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
            $("#" + $(this).attr("data-dialog-id")).on("loaded.bs.modal", function(e) {
                new OwnershipSettingController();
                $("#modal-branch h4").text(titleName);
                $("#modal-branch #shopId").val(shopId);
            });
        });
    });
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的初始化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function() {
    new OwnershipController;
});
