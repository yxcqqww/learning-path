/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：admin.guanaihui.com
 2. 页面名称：employee/list(用户->用户列表)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function ListController() {
    this.quickPanel = $(".data-panel .quick-panel");
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    实例化条理化表格
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.instanceMethodizeTable();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    绑定事件
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.bind();
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
实例化下拉面板
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ListController.prototype.instanceQuickPanel = function() {
    var classSelf = this;
    require([this.appStaticPrefix + "/system/employee.min.js"], function() {
        new EmployeeController({
            quickPanel: classSelf.quickPanel,
            parentClass: classSelf
        });
    });
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
事件绑定
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ListController.prototype.bind = function() {
    var classSelf = this;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    新增按钮首先将保存的apiUrl赋予form的action，然后再将页面载入并实例化
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(".data-panel .assistant .tools .add").click(function() {
        $(classSelf.quickPanel).attr("action", classSelf.apiUrl.system.employee.add);
        classSelf.swapPanel(this);
    });
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    每行里面设为总店和删除按钮以及编辑按钮
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(".data-panel table tbody tr").each(function() {
        var id = $(this).attr("data-id");
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        编辑按钮首先将保存的apiUrl赋予form的action，然后再将页面载入并实例化
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(this).find(".edit").click(function() {
            $(classSelf.quickPanel).attr("action", classSelf.apiUrl.system.employee.edit);
            classSelf.swapPanel(this);
        });
        $(this).find(".remove").click(function() {
            classSelf.remove(id);
        });
    });
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    全局的删除按钮
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(".data-panel .assistant .tools .remove").click(function() {
        classSelf.remove($(".data-panel table input[name='methodize-table-checked-set']").val());
    });
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
门店面板的弹出或者收起
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ListController.prototype.swapPanel = function(handle) {
    var classSelf = this;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    先清空表单内容
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(this.quickPanel).empty();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    然后再将页面异步加载进来并slideDown
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(this.quickPanel).load($(handle).attr("data-href"), function() {
        classSelf.instanceQuickPanel();
        $(this).slideDown(200);
    });
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
删除门店
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ListController.prototype.remove = function(id) {
    var classSelf = this;
    if (!id) {
        classSelf.tips("请先选择用户！", 2);
        return false;
    }
    this.confirm({
        "content": "您确定要删除选中的用户吗？",
        "confirmInterface": function() {
            classSelf.request(classSelf.apiUrl.system.employee.delete, {
                "ids": id,
                "active": "0"
            }, {
                process: function() {
                    classSelf.tips("删除用户成功！", 2, function() {
                        window.location.reload();
                    });
                }
            });
        }
    });
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的初始化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function() {
    new ListController;
});
