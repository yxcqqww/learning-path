/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：admin.guanaihui.com
 2. 页面名称：system/reserPwd(角色->角色列表)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function ResetPwdController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    获取焦点，修改input的type为password
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.changeInputType();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    提交表单
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.save();
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
获取焦点，修改input的type为password
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ResetPwdController.prototype.changeInputType = function() {
    if ($("#resetPwd input[type!='hidden']").size() === 0) return;
    $("#resetPwd input[type!='hidden']").focus(function() {
        var _this = $(this);
        if (_this.attr("type") == "text") {
            _this.attr("type", "password");
        }
    })
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
submit
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ResetPwdController.prototype.save = function() {
    var classSelf = this;
    require([classSelf.utilStaticPrefix + "/jquery.asyncsubmit.min.js"], function() {
        $("#resetPwd").asyncsubmit({
            utilStaticPrefix: classSelf.utilStaticPrefix,
            dataType: classSelf.apiDataType,
            onSavingInterface: function() {
                classSelf.tips("正在进行处理，请稍等...", 2);
            },
            onErrorInterface: function() {
                classSelf.tips("请求失败，请检查您的接口！", 2);
            },
            onSuccessInterface: function(result) {
                classSelf.tips("修改密码成功！", 2, function() {
                    window.location.href = "/logout";
                });
            },
            onExceptionInterface: function(message) {
                classSelf.tips("<span class=\"text-danger\">" + message + "</span>", 5);
            }
        });
    });
};


/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的初始化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function() {
    new ResetPwdController;
});
