/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：admin.guanaihui.com
 2. 页面名称：role/list(角色->角色列表)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function ListController() {
    this.quickPanel = $(".data-panel .quick-panel");
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    实例化条理化表格
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.instanceMethodizeTable();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    实例化dialog
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.instanceDialog();

};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
实例化dialog
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ListController.prototype.instanceDialog = function() {
    var classSelf = this;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    所有dialog句柄点击弹出目标页面
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(".dialog-handle").click(function() {
        var id = $(this).attr("data-dialog-id");
        var dialogHandle = this;
        classSelf.dialog({
            "id": id,
            "url": $(this).attr("data-href"),
            "dimension": "lg"
        });
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        品牌dialog实例化后要实例化角色面板
         -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $("#modal-role").on("loaded.bs.modal", function(e) {
            /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
            判断是新增还是编辑按钮来给表单的action赋值
             -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
            var apiUrl = "";
            if ($(dialogHandle).hasClass("add")) apiUrl = classSelf.apiUrl.system.role.add;
            else if ($(dialogHandle).hasClass("edit")) apiUrl = classSelf.apiUrl.system.role.edit;
            $("#" + id + " form").attr("action", apiUrl);
            /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
            再实例化品角色
             -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
            // classSelf.staticDomain + "/apps/admin.guanaihui.com/jssrc/system/role-bak.js"
            //classSelf.appStaticPrefix + "/system/role.min.js"
            require([classSelf.appStaticPrefix + "/system/role.min.js"], function() {
                new RoleController({
                    rolePanel: $("#" + id),
                    parentClass: classSelf
                });
            });
        });
    });

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    每行里面设为总店和删除按钮以及编辑按钮
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(".data-panel table tbody tr").each(function() {
        var id = $(this).attr("data-id");
        $(this).find(".remove").click(function() {
            classSelf.remove(id);
        });
    });
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    全局的删除按钮
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(".data-panel .assistant .tools .remove").click(function() {
        classSelf.remove($(".data-panel table input[name='methodize-table-checked-set']").val());
    });
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
删除门店
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ListController.prototype.remove = function(id) {
    var classSelf = this;
    if (!id) {
        classSelf.tips("请先选择角色！", 2);
        return false;
    }
    this.confirm({
        "content": "您确定要删除选中的角色吗？",
        "confirmInterface": function() {
            classSelf.request(classSelf.apiUrl.system.role.delete, {
                "ids": id,
                "active": "0"
            }, {
                process: function() {
                    classSelf.tips("删除角色成功！", 2, function() {
                        window.location.reload();
                    });
                }
            });
        }
    });
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的初始化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function() {
    new ListController;
});
