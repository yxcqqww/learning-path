/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：admin.guanaihui.com
 2. 页面名称：role/role(系统设置->用户编辑面板)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function EmployeeController(params) {
    this.quickPanel = params.quickPanel;
    this.parentClass = params.parentClass;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    继承于Controller基类
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    事件绑定
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.bind();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    初始化tagswitch
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.initTagswitch();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    保存用户处理
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.save();
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
初始化tagswitch
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
EmployeeController.prototype.initTagswitch = function() {
    var classSelf = this;
    require([classSelf.utilStaticPrefix + "/tagswitch/jquery.tagswitch.min.js"], function() {
        $(".role-ids").tagswitch({
            dataSaveInto: $("#roleIds"),
            separator: ","
        });
    });
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
事件绑定
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
EmployeeController.prototype.bind = function() {
    var classSelf = this;
    $(this.quickPanel).find(".tools .cancel").click(function() {
        classSelf.close();
    });
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
关闭面板
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
EmployeeController.prototype.close = function() {
    $(this.quickPanel).slideUp(200);
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
根据checkbox状态决定选项是否显示
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
EmployeeController.prototype.initOptional = function() {
    $(this.quickPanel).find(".switcher").each(function() {
        var method = $(this).find(":checked").size() === 0 ? "hide" : "show";
        eval("$(this).find('.optional')." + method + "(100);");
    });
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 保存用户处理
如何知道是新增还是修改？看quickPanel的data-operation属性的值，可以是：add|edit
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
EmployeeController.prototype.save = function() {
    var classSelf = this;
    require([this.parentClass.utilStaticPrefix + "/jquery.asyncsubmit.min.js"], function() {
        $(classSelf.quickPanel).asyncsubmit({
            utilStaticPrefix: classSelf.parentClass.utilStaticPrefix,
            dataType: classSelf.parentClass.apiDataType,
            onSavingInterface: function() {
                classSelf.parentClass.tips("正在进行处理，请稍等...", 2);
            },
            onErrorInterface: function() {
                classSelf.parentClass.tips("请求失败，请检查您的接口！", 2);
            },
            onSuccessInterface: function(result) {
                classSelf.parentClass.tips("用户保存成功！", 2, function() {
                    window.location.reload();
                });
            },
            onExceptionInterface: function(message) {
                classSelf.parentClass.tips("<span class=\"text-danger\">" + message + "</span>", 5);
            }
        });
    });
};
