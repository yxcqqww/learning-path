function CategoryController(){Controller.call(this),this.initZtree(),this.submitForm()}CategoryController.prototype.initZtree=function(){var a=this;a.emptyForm(),a.request(a.apiUrl.shop.categories.tree,[],{process:function(b){function c(a,b){var c=$("#"+b.tId+"_span");if(!(b.editNameFlag||$("#addBtn_"+b.tId).length>0||1===b.level)){var d="<span class='button add' id='addBtn_"+b.tId+"' title='add node' onfocus='this.blur();'></span>";c.after(d);var e=$("#addBtn_"+b.tId);e&&e.bind("click",function(){var a=$.fn.zTree.getZTreeObj("tree");return a.addNodes(b,{pId:b.id,name:"新加节点"}),!1})}}function d(a,b){$("#addBtn_"+b.tId).unbind().remove()}function e(b,c){a.request(a.apiUrl.shop.categories["delete"],{id:c.id},{process:function(b){console.log("删除节点成功！"),a.tips("删除节点成功",2,function(){a.initZtree()})}})}function f(a,b,c){var d=c.id,e=c.pId,f=!0;$("#nodeClickId").val(d);for(var h=0,i=g.length;i>h;h++)if(d==g[h].id){var j=$("#treeNodeContent");j.find("input[name='grade']").val(g[h].grade),j.find("input[name='name']").val(g[h].name),j.find("textarea[name='description']").val(g[h].description),j.find("select[name='pId']").val(g[h].pId),j.find("input[name='idx']").val(g[h].idx),j.find("select[name='cIcon']").val(g[h].cIcon),j.find("select[name='isActive']").val(g[h].isActive?"1":"0"),f=!1}e&&f&&($("#treeNodeContent input[name='grade']").val("2"),$("#treeNodeContent input[name='name']").val("新加节点"),$("#treeNodeContent select[name='pId']").val(e),$("#treeNodeContent textarea[name='description']").val(""),$("#treeNodeContent input[name='idx']").val(""))}var g=b.result,h={edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1},view:{addHoverDom:c,removeHoverDom:d,selectedMulti:!1},data:{simpleData:{enable:!0}},callback:{beforeRemove:e,onClick:f}};$.fn.zTree.init($("#tree"),h,g)}})},CategoryController.prototype.emptyForm=function(){var a=$("#treeNodeContent");a.find("input[name='grade']").val(""),a.find("input[name='name']").val(""),a.find("textarea[name='description']").val(""),a.find("select[name='pId']").val(""),a.find("input[name='idx']").val(""),a.find("select[name='cIcon']").val(""),a.find("select[name='isActive']").val("1")},CategoryController.prototype.submitForm=function(){var a=this;require([a.utilStaticPrefix+"/validation/js/languages/jquery.validationEngine-zh_CN.js",a.utilStaticPrefix+"/validation/js/jquery.validationEngine.js"],function(){$("#treeNodeContent").validationEngine({promptPosition:"topLeft",autoHidePrompt:!0,autoHideDelay:5e3,showOneMessage:!0,maxErrorsPerField:1,validationEventTrigger:"",scroll:!1}),$("#btnSubmit").click(function(){var b=$("#nodeClickId").val(),c=a.apiUrl.shop.categories.edit,d=$("#treeNodeContent").validationEngine("validate");return d?void(0===$("#tree .curSelectedNode").size()?a.tips("您没有选择节点",3):((void 0==b||""==b)&&(c=a.apiUrl.shop.categories.add),a.request(c,{id:b,grade:$("input[name='grade']").val(),name:$("input[name='name']").val(),description:$("textarea[name='description']").val()||" ",pId:$("select[name='pId']").val(),idx:$("input[name='idx']").val(),cIcon:$("select[name='cIcon']").val(),isActive:$("select[name='isActive']").val()?!0:!1,open:!0},{process:function(b){a.tips("修改节点详情完成!",3,function(){a.initZtree()})}}))):!1})})},$(document).ready(function(){new CategoryController});