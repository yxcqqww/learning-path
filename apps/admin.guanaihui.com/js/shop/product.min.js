function ProductController(a){this.productPanel=a.productPanel,this.parentClass=a.parentClass,this.parentClass.swapTabs({eventType:"click",effect:"fadeIn",duration:100}),this.initSelectOptions(),this.instanceSelect2(),this.initUploadify(),this.bind(),this.save(),this.changePosition()}ProductController.prototype.bind=function(){var a=this;$(this.productPanel).find(".items .add").click(function(){a.addItem(),$(".j-btn-up").html("上移").eq(0).html(""),1!=$(".j-btn-up").length&&$(".j-btn-down").html("下移").eq($(".j-btn-up").length-1).html("")}),$(this.productPanel).find(".items .addIntr").click(function(){a.addIntroduct(),$(".j-btn-up").html("上移").eq(0).html(""),1!=$(".j-btn-up").length&&$(".j-btn-down").html("下移").eq($(".j-btn-up").length-1).html("")}),$(this.productPanel).find(".notices .add").click(function(){var b=$.trim($(a.productPanel).find(".notices input[name='notice']").val());return b?(a.addNotice(b),void $(a.productPanel).find(".notices input[name='notice']").val("")):(a.parentClass.tips("请输入内容！",2),!1)}),$(this.productPanel).find(".notices .result li").each(function(){var a=this;$(this).find(".remove").click(function(){a.remove()})}),$(this.productPanel).find(".items table tbody tr").each(function(){var b=this;$(this).find(".remove").click(function(){var c=$(this).parent("td").siblings(".noWidth").find(".itemId").val();$(".items input[name='itemsDelId']").val($(".items input[name='itemsDelId']").val()+"&&"+c),console.log($(".items input[name='itemsDelId']").val()),b.remove(),a.totalMarketPrice(),a.totalGuanaiPrice(),a.totalVipPrice()}),$(this).find("input[name='streetPrice']").change(function(){a.totalMarketPrice()}),$(this).find("input[name='promotionPrice']").change(function(){a.totalGuanaiPrice()}),$(this).find("input[name='giftCardPrice']").change(function(){a.totalVipPrice()})})},ProductController.prototype.addItem=function(){var a=this,b=$(document.createElement("TR")).append('<td><a href="javascript:;" class="j-btn-up">上移</a><a href="javascript:;" class="j-btn-down">下移</a></td>').append('<td><input name="itemName" class="form-control  input-sm" data-validation-engine="validate[required,maxSize[10]]" placeholder="10汉字以内"></td>').append('<td><input name="amount" class="form-control  input-sm" data-validation-engine="validate[custom[integer],max[9]]"></td>'),c=$(document.createElement("INPUT")).attr("name","streetPrice").attr("data-validation-engine","validate[custom[number],max[100000]]").addClass("form-control input-sm");c.change(function(){a.totalMarketPrice()});var d=$(document.createElement("TD")).append(c);b.append(d);var e=$(document.createElement("INPUT")).attr("name","promotionPrice").attr("data-validation-engine","validate[custom[number],max[100000]]").addClass("form-control input-sm");e.change(function(){a.totalGuanaiPrice()});var f=$(document.createElement("TD")).append(e);b.append(f);var g=$(document.createElement("INPUT")).attr("name","giftCardPrice").attr("data-validation-engine","validate[custom[number],max[100000]]").addClass("form-control input-sm");g.change(function(){a.totalVipPrice()});var h=$(document.createElement("TD")).append(g);b.append(h);var i=$(document.createElement("I")).addClass("iconfont icon-shanchu remove");b.append($(document.createElement("TD")).append(i)),b.append('<td class="noWidth"><input style="display:none;" class="itemId" name="itemId" value=""></td><td class="noWidth"><input style="display:none;" class="itemType" name="itemType" value="1"></td>'),i.click(function(){b.remove(),a.totalMarketPrice(),a.totalGuanaiPrice(),a.totalVipPrice()}),$(this.productPanel).find(".modal-body .items table tbody").append(b)},ProductController.prototype.addIntroduct=function(){var a=this,b=$(document.createElement("TR")).append('<td><a href="javascript:;" class="j-btn-up">上移</a><a href="javascript:;" class="j-btn-down">下移</a></td>').append('<td  colspan="5" class="onlyW"><input name="itemName" class="form-control intro input-sm" data-validation-engine="validate[required,maxSize[10]]" placeholder="10汉字以内"></td>'),c=$(document.createElement("I")).addClass("iconfont icon-shanchu remove");b.append($(document.createElement("TD")).append(c)),b.append('<td class="noWidth"><input style="display:none;" class="itemId" name="itemId" value=""></td><td class="noWidth"><input style="display:none;" class="itemType" name="itemType" value="2"></td>'),c.click(function(){b.remove(),a.totalMarketPrice(),a.totalGuanaiPrice(),a.totalVipPrice()}),$(this.productPanel).find(".modal-body .items table tbody").append(b)},ProductController.prototype.changePosition=function(){$(".j-btn-up").eq(0).html(""),1!=$(".j-btn-up").length&&$(".j-btn-down").html("下移").eq($(".j-btn-up").length-1).html(""),$("body").on("click",".j-btn-up",function(){var a=$(this).parents("tr:eq(0)"),b=a.prev();if(b.length>0){var c=a.clone();a.remove(),c.insertBefore(b)}$(".j-btn-up").html("上移").eq(0).html(""),$(".j-btn-down").html("下移").eq($(".j-btn-up").length-1).html("")}),$("body").on("click",".j-btn-down",function(){var a=$(this).parents("tr:eq(0)"),b=a.next();if(b.length>0){var c=a.clone();a.remove(),c.insertAfter(b)}$(".j-btn-up").html("上移").eq(0).html(""),1!=$(".j-btn-up").length&&$(".j-btn-down").html("下移").eq($(".j-btn-up").length-1).html("")})},ProductController.prototype.addNotice=function(a){var b=$(document.createElement("LI")).append(document.createTextNode(a)),c=$(document.createElement("A")).append('<i class="iconfont icon-shanchu remove"></i>');b.append(c),c.click(function(){b.remove()}),$(this.productPanel).find(".modal-body .notices .result").append(b)},ProductController.prototype.instanceSelect2=function(a){$(this.productPanel).find("select").select2({placeholder:"请选择",width:"100%"})},ProductController.prototype.save=function(){var a=this;require([this.parentClass.utilStaticPrefix+"/jquery.asyncsubmit.min.js"],function(){$(a.productPanel).find("form").asyncsubmit({utilStaticPrefix:a.parentClass.utilStaticPrefix,dataType:a.parentClass.apiDataType,beforeSaveInterface:function(){a.union()},onSavingInterface:function(){a.parentClass.tips("正在进行处理，请稍等...")},onErrorInterface:function(){a.parentClass.tips("请求失败，请检查您的接口！",2)},onSuccessInterface:function(b){a.parentClass.tips("保存服务成功！",2,function(){window.location.reload()})},onExceptionInterface:function(b){a.parentClass.tips('<span class="text-danger">'+b+"</span>",5)}})})},ProductController.prototype.union=function(){var a=new Array;$(this.productPanel).find(".notices .result li").each(function(){a.push($(this).text())}),$(this.productPanel).find(".notices input[name='notices']").val(a.join("&&"));var b=new Array;$(this.productPanel).find(".items tbody tr").each(function(){var a=$(this).find("input[name='itemName']").val();a&&(a=$.trim(a));var c=$(this).find("input[name='amount']").val();c&&(c=$.trim(c));var d=$(this).find("input[name='streetPrice']").val();d&&(d=$.trim(d));var e=$(this).find("input[name='promotionPrice']").val();e&&(e=$.trim(e));var f=$(this).find("input[name='giftCardPrice']").val();f&&(f=$.trim(f));var g=$(this).find("input[name='itemId']").val();g&&(g=$.trim(g));var h=$(this).find("input[name='itemType']").val();h&&(h=$.trim(h)),b.push(g+"||"+a+"||"+c+"||"+d+"||"+e+"||"+f+"||"+h)}),console.log(b),$(this.productPanel).find(".items input[name='items']").val(b.join("&&"))},ProductController.prototype.initSelectOptions=function(){var a=$(this.productPanel).find("input[name='shopIds']").val(),b=new Array;a&&(b=a.split(",")),$(this.productPanel).find("select[name='branches'] option").each(function(){-1!==$.inArray($(this).attr("value"),b)&&$(this).attr("selected","selected")});var c=$(this.productPanel).find("input[name='tagIds']").val(),d=new Array;c&&(d=c.split(",")),$(this.productPanel).find("select[name='tags'] option").each(function(){-1!==$.inArray($(this).attr("value"),d)&&$(this).attr("selected","selected")})},ProductController.prototype.totalMarketPrice=function(){var a=0;$(this.productPanel).find(".tabs .items tbody tr").each(function(){var b=$(this).find("input[name='streetPrice']").val();b&&(b=$.trim(b)),b&&(a+=parseFloat(b))}),$(this.productPanel).find(".tabs .items tfoot input[name='marketPrice']").val(a)},ProductController.prototype.totalGuanaiPrice=function(){var a=0;$(this.productPanel).find(".tabs .items tbody tr").each(function(){var b=$(this).find("input[name='promotionPrice']").val();b&&(b=$.trim(b)),b&&(a+=parseFloat(b))}),$(this.productPanel).find(".tabs .items tfoot input[name='guanaiPrice']").val(a)},ProductController.prototype.totalVipPrice=function(){var a=0;$(this.productPanel).find(".tabs .items tbody tr").each(function(){var b=$(this).find("input[name='giftCardPrice']").val();b&&(b=$.trim(b)),b&&(a+=parseFloat(b))}),$(this.productPanel).find(".tabs .items tfoot input[name='vipPrice']").val(a)},ProductController.prototype.initUploadify=function(){var a=this,b=$(this.productPanel).find(".modal-body .file-uploader");b.empty(),b.append('<div id="queue" data-amount-successful="0" data-amount-errored="0" data-related-successful="0"></div>');var c=$(document.createElement("INPUT")).attr("id","fileUploader").attr("type","file").attr("name","files").attr("multiple",!0);b.append(c),require([this.parentClass.utilStaticPrefix+"/uploadify/jquery.uploadify.min.js"],function(){$("#fileUploader").uploadify({buttonText:" + 上传图片",height:34,fileObjName:"files",fileSizeLimit:"1024KB",fileTypeExts:"*.jpg;*.jpeg;*.png",formData:{category:"product"},swf:"/static/uploadify/uploadify.swf",uploader:a.parentClass.apiUrl.attachment.upload,uploadLimit:9,removeTimeout:1,width:120,onQueueComplete:function(a){$("#queue").attr("data-amount-successful",a.uploadsSuccessful).attr("data-amount-errored",a.uploadsErrored)},onUploadSuccess:function(b,c,d){var c=$.parseJSON(c),e=new Array;$(c.result).each(function(){e.push(this.url)}),$(a.productPanel).find(".modal-body input[name='logoUrl']").val(e.join(",")),$(a.productPanel).find(".modal-body .uploaded-pict img").attr("src",e[0]),$(a.productPanel).find(".modal-body .uploaded-pict").show()}})})};