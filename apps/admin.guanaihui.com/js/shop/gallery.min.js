function GalleryController(){this.thumbIdSeparator=",",Controller.call(this),this.instanceThumbnail(),this.bind(),this.backCompanyList(),this.redirect(),this.initTabs()}GalleryController.prototype.instanceThumbnail=function(){var t=this;require([this.appStaticPrefix+"/jquery.thumbnail.min.js"],function(){$(".thumbnail-preview .thumb").thumbnail({onDelete:function(a){t.removeThumbnail(a,$(".data-panel .tabs .tabs-handle li.on").attr("data-category"))}})})},GalleryController.prototype.bind=function(){var t=this;$(".data-panel .assistant .select-all").click(function(){t.selectAll(this)}),$(".data-panel .assistant .save-sequence").click(function(){t.saveSequence()}),$(".data-panel .assistant .remove").click(function(){var a=new Array;$(".tabs .tabs-frame:visible .thumb").each(function(){$(this).find(".handle:visible").size()>0&&a.push($(this).find("img").attr("data-id"))});var e=a.join(t.thumbIdSeparator);return""===e?(t.tips("请选择图片！",2),!1):void t.removeThumbnail(e,$(".data-panel .tabs .tabs-handle li.on").attr("data-category"))})},GalleryController.prototype.selectAll=function(t){var a=$(t).attr("data-status");"false"===a?($(".data-panel .tabs .tabs-frame:visible .thumb .handle").show(),$(t).attr("data-status","true").text("取消全选")):($(".data-panel .tabs .tabs-frame:visible .thumb .handle").hide(),$(t).attr("data-status","false").text("全选"))},GalleryController.prototype.removeThumbnail=function(t,a){var e=this;this.confirm({content:"您确定要删除图片吗？",confirmInterface:function(){e.request(e.apiUrl.shop.gallery.delete,{imageIds:t,profileType:a},{process:function(){e.tips("删除图片成功！",2,function(){var a=t.split(e.thumbIdSeparator);$(".tabs .tabs-frame:visible .thumb").each(function(){var t=$(this).find("img").attr("data-id").toString();-1!=$.inArray(t,a)&&$(this).remove()}),window.location.reload()})}})}})},GalleryController.prototype.saveSequence=function(){if(0===$(".tabs .tabs-frame:visible .thumb").size())return this.tips("连图片都没有了，还有个毛的顺序啊！",2),!1;var t=this,a=new Array;$(".tabs .tabs-frame:visible .thumb").each(function(t,e){a.push($(e).find("img").attr("data-id"))}),this.request(this.apiUrl.shop.gallery.sequence,{idOrderList:a.join(",")},{process:function(){t.tips("保存图片顺序成功！",2,function(){window.location.reload()})}})},GalleryController.prototype.initUploadify=function(){var t=this;$(".data-panel .assistant .file-uploader").empty(),$(".data-panel .assistant .file-uploader").append('<div id="queue" data-amount-successful="0" data-amount-errored="0" data-related-successful="0"></div>');var a=$(document.createElement("INPUT")).attr("id","fileUploader").attr("type","file").attr("name","files").attr("multiple",!0);$(".data-panel .assistant .file-uploader").append(a),require([this.utilStaticPrefix+"/uploadify/jquery.uploadify.min.js"],function(){$("#fileUploader").uploadify({buttonText:" + 添加当前类别图片",height:34,fileObjName:"files",fileSizeLimit:"1024KB",fileTypeExts:"*.jpg;*.jpeg;*.png",formData:{category:$(".data-panel .tabs .tabs-handle li.on").attr("data-category")},swf:"/static/uploadify/uploadify.swf",uploader:t.apiUrl.attachment.upload,uploadLimit:9,removeTimeout:1,width:150,onQueueComplete:function(t){$("#queue").attr("data-amount-successful",t.uploadsSuccessful).attr("data-amount-errored",t.uploadsErrored)},onUploadSuccess:function(a,e){var e=$.parseJSON(e),i={};i.companyId=$(".data-panel .tabs input[name='companyId']").val(),i.profileType=$(".data-panel .tabs .tabs-handle li.on").attr("data-category");var n=new Array;$(e.result).each(function(){n.push(this.url)}),i.fileUrlList=n.join(","),t.request(t.apiUrl.shop.gallery.classify,i,{loadingTips:!0,process:function(){var a=parseInt($("#queue").attr("data-related-successful"),10);$("#queue").attr("data-related-successful",a+1),parseInt($("#queue").attr("data-related-successful"),10)===parseInt($("#queue").attr("data-amount-successful"),10)&&t.tips($("#queue").attr("data-amount-successful")+" 张图片上传成功；"+$("#queue").attr("data-amount-errored")+" 张图片上传失败！",3,function(){window.location.reload()})}})}})})},GalleryController.prototype.initTabs=function(){var t=this;this.swapTabs({eventType:"click",effect:"fadeIn",duration:100,onSwitch:function(){var a=$(".data-panel .tabs .tabs-handle li.on").attr("data-category"),e=$(".data-panel .assistant .save-sequence");t.initUploadify(),$.cookie(t.cookieKeyConf.shop.gallery.category,a,{expires:t.cookieExpires,path:"/",domain:t.cookieDomain}),"AppLogo"===a||"Thumbnail"===a?e.hide(100):e.show(100)}})},GalleryController.prototype.redirect=function(){var t=this;$(".data-panel .tabs .tabs-handle li").each(function(){$(this).attr("data-category")===$.cookie(t.cookieKeyConf.shop.gallery.category)&&$(this).addClass("on")})},$(document).ready(function(){new GalleryController});