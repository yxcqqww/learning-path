function SelectUsersController(e){this.usersPanel=e.usersPanel,this.parentClass=e.parentClass,this.maximum=null===e||null===e.maximum||void 0===e.maximum?1:e.maximum,this.resultSeparator=null===e||null===e.resultSeparator||void 0===e.resultSeparator?",":e.resultSeparator,this.memoryCapacity=null===e||null===e.memoryCapacity||void 0===e.memoryCapacity?8:e.memoryCapacity,this.onSelected=null===e||null===e.onSelected||void 0===e.onSelected?null:e.onSelected,this.instanceTabs(),this.readMemory(),this.empty(),this.bind()}SelectUsersController.prototype.instanceTabs=function(){var e=this;require([this.parentClass.utilStaticPrefix+"/jquery.tabs.min.js"],function(){$(e.usersPanel).find(".tabs").tabs({eventType:"click",effect:"fadeIn",duration:200})})},SelectUsersController.prototype.empty=function(){$(this.usersPanel).find(".result-panel .result-scope").empty()},SelectUsersController.prototype.bind=function(){var e=this;$(this.usersPanel).find(".filter-panel .indexes a").click(function(){$(e.usersPanel).find(".filter-panel .indexes a").removeClass("on"),$(this).addClass("on"),e.letterIndex($(this).text())}),$(this.usersPanel).find(".result-panel .empty").click(function(){e.empty()}),$(this.usersPanel).find(".filter-panel .result-scope a").on("click",function(){e.select(this)}),$(this.usersPanel).find(".modal-footer button[type='submit']").on("click",function(){e.confirm()}),$(this.usersPanel).find(".filter-form button").on("click",function(){var t=$(e.usersPanel).find(".filter-form input[name='keywords']").val(),s=$(e.usersPanel).find(".content .tabs .all-frame .result-scope a");t&&(t=$.trim(t)),t?s.each(function(){var e=$(this).find(".username").text();-1!=e.indexOf(t)?$(this).slideDown(100):$(this).slideUp(100)}):s.slideDown(100)})},SelectUsersController.prototype.initTree=function(){var e=this;require([this.parentClass.utilStaticPrefix+"/ztree/js/jquery.ztree.exedit-3.5.js",this.parentClass.utilStaticPrefix+"/ztree/js/jquery.ztree.excheck-3.5.js"],function(){$.fn.zTree.init(e.treeContainer,e.settings,organizeTreeNodes)})},SelectUsersController.prototype.readMemory=function(){var e=this,t=$(this.usersPanel).find(".filter-panel .recently-frame");t.empty();var s=$.cookie(this.parentClass.cookieKeyConf.public.selectUsers.selectedRecently);if(s){var i=s.split("&");$(i).each(function(){var s=this.split("|"),i=$(document.createElement("A")).attr("href","javascript:void(0);").attr("data-id",s[0]).attr("data-fp",s[1]).append('<span class="position">'+s[3]+"</span>").append('<img src="'+e.parentClass.staticDomain+'/apps/admin.guanaihui.com/css/images/default-portrait.jpg" class="img-circle">').append('<span class="username">'+s[2]+"</span>");t.append(i)})}},SelectUsersController.prototype.letterIndex=function(e){return e?(e=$.trim(e).toLowerCase(),void $(this.usersPanel).find(".filter-panel .all-frame .result-scope a").each(function(){var t=$.trim($(this).attr("data-fp")).toLowerCase();t===e?$(this).fadeIn(100):$(this).fadeOut(100)})):void $(this.usersPanel).find(".filter-panel .all-frame .result-scope a").fadeIn(100)},SelectUsersController.prototype.select=function(e){var t=$(this.usersPanel).find(".result-panel .result-scope a");if(t.size()>=this.maximum)return this.parentClass.tips("您最多可以选择"+this.maximum+"人！",2),!1;var s=$(e).attr("data-id").toString(),i=0;if(t.each(function(){return s===$(this).attr("data-id").toString()?(i++,!1):void 0}),i>0)return this.parentClass.tips("已经在选择好的人员列表中！",2),!1;var n=$(e).clone(),r=$(document.createElement("SPAN")).addClass("remove").append('<i class="iconfont icon-shanchu1"></i>');r.click(function(){n.remove()}),n.prepend(r),n.hover(function(){r.fadeIn(100)},function(){r.fadeOut(100)}),$(this.usersPanel).find(".result-panel .result-scope").append(n)},SelectUsersController.prototype.memory=function(){var e=$(this.usersPanel).find(".result-panel .result-scope a"),t=$.cookie(this.parentClass.cookieKeyConf.public.selectUsers.selectedRecently),s=new Array;t&&(s=t.split("&"));var i=new Array;e.each(function(){i.push($(this).attr("data-id")+"|"+$(this).attr("data-fp")+"|"+$.trim($(this).find(".username").text())+"|"+$.trim($(this).find(".position").text().toString()))}),i.concat(s).slice(0,this.memoryCapacity),$.cookie(this.parentClass.cookieKeyConf.public.selectUsers.selectedRecently,i.join("&"),{expires:this.parentClass.cookieExpires,path:"/",domain:this.parentClass.cookieDomain})},SelectUsersController.prototype.confirm=function(){this.memory();var e=$(this.usersPanel).find(".result-panel .result-scope a"),t=new Array,s=new Array;e.each(function(){t.push($(this).attr("data-id")),s.push($.trim($(this).find(".username").text()))}),this.onSelected&&this.onSelected(t.join(this.resultSeparator),s.join(this.resultSeparator))};