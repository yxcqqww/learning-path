function StationsController(){this.domain="http://testapi.cddtwx.cn/",this.centerLongitude=430,this.centerLatitude=100,this.cycleRadius=13,this.guideAnimation=!1,this.allStationsApiUrl=this.domain+"/api/Metro/GetAllStation",this.navigatorApiUrl=this.domain+"/api/Metro/MetroPathQuery",this.stationDetailUrlPrefix=this.domain+"/metro/stationdetail",this.queryDetailUrlPrefix=this.domain+"/metro/metroquery",Controller.call(this),this.timer={},this.mapLoaded(),this.drawStations(),this.drawLocationIcon(),this.bind()}StationsController.prototype.mapLoaded=function(){$(".map img").one("load",function(){$(".loading").fadeOut(200)}).each(function(){this.complete&&$(this).load()})},StationsController.prototype.isReady=function(){return""==$("#startId").val()||""==$("#terminalId").val()?!1:!0},StationsController.prototype.initPosition=function(){var t=this;$("html,body").animate({scrollLeft:t.centerLongitude+"px",scrollTop:t.centerLatitude+"px"},500)},StationsController.prototype.drawLocationIcon=function(){$(document.body).append($(document.createElement("DIV")).addClass("location start")),$(document.body).append($(document.createElement("DIV")).addClass("location terminal"))},StationsController.prototype.drawStations=function(){var t=this;this.request(this.allStationsApiUrl,{},{process:function(e){$(e.returnObject).each(function(){var e=$(document.createElement("DIV")).attr("id",this.cName).attr("data-name",this.cName).addClass("cycle").css({width:2*t.cycleRadius+"px",height:2*t.cycleRadius+"px",left:this.x-t.cycleRadius+"px",top:this.y-t.cycleRadius+"px"}).fadeTo(200,.01);$(document.body).append(e),e.click(function(e){var a=$(this).offset();$(".context-menu").show().css({left:a.left+"px",top:a.top+"px"}).attr("data-target",$(this).attr("id")),$("#viewStationDetail").attr("href",t.stationDetailUrlPrefix+"?name="+encodeURIComponent($(this).attr("id"))),$(".context-menu .selected-station").text($(this).attr("data-name")),e.stopPropagation()})})}})},StationsController.prototype.bind=function(){var t=this;$(document.body).click(function(){$(".context-menu").hide()}),$("#setAsStart").click(function(){$("#terminalId").val()===$(".context-menu").attr("data-target")&&t.clearKey("terminal"),t.setKey("start"),t.navigate()}),$("#setAsTerminal").click(function(){$("#startlId").val()===$(".context-menu").attr("data-target")&&t.clearKey("start"),t.setKey("terminal"),t.navigate()}),$(".memo .close").click(function(e){t.reset(),e.stopPropagation()})},StationsController.prototype.navigate=function(){if(this.isReady()){var t=this;this.request(this.navigatorApiUrl,{startStation:$("#startId").val(),endStation:$("#terminalId").val()},{process:function(e){$(".mask").show(),$(e.returnObject.stationCollection).each(function(e,a){var o=null;t.guideAnimation&&(o=function(){t.timer[e]=window.setInterval(function(){$("#"+a.cName).fadeTo(500,0).fadeTo(500,1)},2e3)}),$("#"+a.cName).delay(100*e).fadeTo(500,1,o)}),$(".memo .summary").html(e.returnObject.summary),$(".memo").click(function(){var e=encodeURIComponent($("#startId").val()),a=encodeURIComponent($("#terminalId").val());$("#startId").val(""),$("#terminalId").val(""),window.location=t.queryDetailUrlPrefix+"?start="+e+"&end="+a}),$(".memo").show()}})}},StationsController.prototype.setKey=function(t){$("#"+t+"Id").val($(".context-menu").attr("data-target"));var e=$("#"+$(".context-menu").attr("data-target")).position();$(".location."+t).css({left:e.left+this.cycleRadius-20+"px",top:e.top+this.cycleRadius-48+"px"}).show(),$(".memo ."+t+"-station").html($("#"+$(".context-menu").attr("data-target")).attr("data-name"))},StationsController.prototype.clearKey=function(t){$("#"+t+"Id").val(),$(".location."+t).hide(),$(".memo ."+t+"-station").empty()},StationsController.prototype.reset=function(){$(".mask").hide(),$(".location").hide();for(key in this.timer)window.clearInterval(this.timer[key]);$(".cycle").fadeTo(200,0),$(".memo").hide(),$("#startId").val(""),$("#terminalId").val("")},$(document).ready(function(){new StationsController});