!function(t){var e={init:function(o){return this.each(function(){var a=t(this),r=a.data("eraser");if(!r){var n=a.width(),c=a.height(),i=a.offset(),u=t("<canvas/>"),s=u.get(0),h=o&&o.size?o.size:40,p=o&&o.completeRatio?o.completeRatio:.7,l=o&&o.completeFunction?o.completeFunction:null,m=[],f=Math.floor(n/h),v=f*Math.floor(c/h),d=v,g=s.getContext("2d");for(a.after(u),s.id=this.id,s.className=this.className,s.width=n,s.height=c,g.drawImage(this,0,0),a.remove(),g.globalCompositeOperation="destination-out",g.strokeStyle="rgba(255,0,0,255)",g.lineWidth=h,g.lineCap="round",u.bind("mousedown.eraser",e.mouseDown),u.bind("touchstart.eraser",e.touchStart),u.bind("touchmove.eraser",e.touchMove),u.bind("touchend.eraser",e.touchEnd);d--;)m.push(1);r={posX:i.left,posY:i.top,touchDown:!1,touchID:-999,touchX:0,touchY:0,ptouchX:0,ptouchY:0,canvas:u,ctx:g,w:n,h:c,source:this,size:h,parts:m,colParts:f,numParts:v,ratio:0,complete:!1,completeRatio:p,completeFunction:l},u.data("eraser",r),t(window).resize(function(){var t=u.offset();r.posX=t.left,r.posY=t.top})}})},touchStart:function(o){var a=t(this),r=a.data("eraser");if(!r.touchDown){var n=o.originalEvent.changedTouches[0],c=n.pageX-r.posX,i=n.pageY-r.posY;e.evaluatePoint(r,c,i),r.touchDown=!0,r.touchID=n.identifier,r.touchX=c,r.touchY=i,o.preventDefault()}},touchMove:function(o){var a=t(this),r=a.data("eraser");if(r.touchDown)for(var n=o.originalEvent.changedTouches,c=n.length;c--;)if(n[c].identifier==r.touchID){var i=n[c].pageX-r.posX,u=n[c].pageY-r.posY;e.evaluatePoint(r,i,u),r.ctx.beginPath(),r.ctx.moveTo(r.touchX,r.touchY),r.touchX=i,r.touchY=u,r.ctx.lineTo(r.touchX,r.touchY),r.ctx.stroke(),o.preventDefault();break}},touchEnd:function(e){var o=t(this),a=o.data("eraser");if(a.touchDown)for(var r=e.originalEvent.changedTouches,n=r.length;n--;)if(r[n].identifier==a.touchID){a.touchDown=!1,e.preventDefault();break}},evaluatePoint:function(t,e,o){var a=Math.floor(e/t.size)+Math.floor(o/t.size)*t.colParts;a>=0&&a<t.numParts&&(t.ratio+=t.parts[a],t.parts[a]=0,t.complete||t.ratio/t.numParts>=t.completeRatio&&(t.complete=!0,null!=t.completeFunction&&t.completeFunction()))},mouseDown:function(o){var a=t(this),r=a.data("eraser"),n=o.pageX-r.posX,c=o.pageY-r.posY;e.evaluatePoint(r,n,c),r.touchDown=!0,r.touchX=n,r.touchY=c,r.ctx.beginPath(),r.ctx.moveTo(r.touchX-1,r.touchY),r.ctx.lineTo(r.touchX,r.touchY),r.ctx.stroke(),a.bind("mousemove.eraser",e.mouseMove),t(document).bind("mouseup.eraser",r,e.mouseUp),o.preventDefault()},mouseMove:function(o){var a=t(this),r=a.data("eraser"),n=o.pageX-r.posX,c=o.pageY-r.posY;e.evaluatePoint(r,n,c),r.ctx.beginPath(),r.ctx.moveTo(r.touchX,r.touchY),r.touchX=n,r.touchY=c,r.ctx.lineTo(r.touchX,r.touchY),r.ctx.stroke(),o.preventDefault()},mouseUp:function(e){var o=e.data,a=o.canvas;o.touchDown=!1,a.unbind("mousemove.eraser"),t(document).unbind("mouseup.eraser"),e.preventDefault()},clear:function(){var e=t(this),o=e.data("eraser");if(o){o.ctx.clearRect(0,0,o.w,o.h);for(var a=o.numParts;a--;)o.parts[a]=0;o.ratio=o.numParts,o.complete=!0,null!=o.completeFunction&&o.completeFunction()}},size:function(e){var o=t(this),a=o.data("eraser");a&&e&&(a.size=e,a.ctx.lineWidth=e)},reset:function(){var e=t(this),o=e.data("eraser");if(o){o.ctx.globalCompositeOperation="source-over",o.ctx.drawImage(o.source,0,0),o.ctx.globalCompositeOperation="destination-out";for(var a=o.numParts;a--;)o.parts[a]=1;o.ratio=0,o.complete=!1}}};t.fn.eraser=function(o){return e[o]?e[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof o&&o?(t.error("Method "+o+" does not yet exist on jQuery.eraser"),void 0):e.init.apply(this,arguments)}}(jQuery);